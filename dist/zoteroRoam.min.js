/* @alixlahuec/zotero-roam | 0.6.65 | 2021-09-13 */

var zoteroRoam={};(()=>{zoteroRoam={Shortcut:function(e){for(k in this.action=e.action,this.template={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},this.watcher={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},e.template)this.template[`${k}`]=e.template[`${k}`],this.watcher[`${k}`]=!1;Object.keys(this.template).every(e=>!1===this.template[e])&&(this.template={})},Pagination:function(e){this.data=e.data,this.itemsPerPage=e.itemsPerPage||zoteroRoam.config.params.citations.itemsPerPage,this.currentPage=1,this.nbPages=Math.ceil(this.data.length/this.itemsPerPage),this.startIndex=(this.currentPage-1)*this.itemsPerPage+1,this.updateStartIndex=function(){this.startIndex=(this.currentPage-1)*this.itemsPerPage+1},this.getCurrentPageData=function(){return this.getPageData(this.currentPage)},this.getPageData=function(e){return this.data.slice(start=this.itemsPerPage*(e-1),end=this.itemsPerPage*e)},this.previousPage=function(){--this.currentPage,this.currentPage<1&&(this.currentPage=1),this.updateStartIndex(),zoteroRoam.interface.renderCitationsPagination()},this.nextPage=function(){this.currentPage+=1,this.currentPage>this.nbPages&&(this.currentPage=this.nbPages),this.updateStartIndex(),zoteroRoam.interface.renderCitationsPagination()}},version:"0.6.65",data:{items:[],collections:[],semantic:[],libraries:[],keys:[],roamPages:[]},librarySearch:{autocomplete:null},activeImport:{libraries:[],currentLib:{}},citations:{pagination:null,autocomplete:null,currentDOI:"",currentCitekey:"",currentType:"citations",activeImport:null},webImport:{currentBlock:null,activeImport:null},tagSelection:{autocomplete:null},config:{autoComplete:{data:{src:async function(){let e=[];return 0<zoteroRoam.data.items.length&&(e=zoteroRoam.handlers.simplifyDataArray(zoteroRoam.data.items)),e},keys:["title","authorsString","year","tagsString","key","_multiField"],cache:!1,filter:e=>{const t=Array.from(new Set(e.map(e=>e.value.key))).map(t=>e.filter(e=>e.value.key==t).sort((t,o)=>zoteroRoam.config.autoComplete.data.keys.findIndex(e=>e==t.key)<zoteroRoam.config.autoComplete.data.keys.findIndex(e=>e==o.key)?-1:1)[0]);return t.sort((e,t)=>0==e.value.authors.length?2:e.value.authors.toLowerCase()<t.value.authors.toLowerCase()||0==t.value.authors.length?0:1)}},selector:"#zotero-roam-search-autocomplete",wrapper:!1,trigger:e=>0!=e.length||(document.querySelector(".zotero-roam-library-results-count").innerHTML="",!1),searchEngine:(e,t)=>zoteroRoam.utils.multiwordMatch(e,t),resultsList:{class:"zotero-roam-search-results-list",id:"zotero-roam-search-results-list",destination:"#zotero-roam-library-search-div",position:"beforeend",maxResults:100,element:(e,t)=>{e.classList.add("bp3-menu"),t.results&&0<t.results.length&&(document.querySelector(".zotero-roam-library-results-count").innerHTML=`
                            <strong>${t.results.length}</strong> / ${t.matches.length} results
                            `)}},resultItem:{tag:"li",class:"zotero-roam-search_result",id:"zotero-roam-search_result",highlight:"result_highlighted",element:(e,t)=>{var o=`<span class="zotero-roam-search-item-metadata"> ${t.value.meta}</span>`,a=`<span class="zotero-roam-search-item-title" style="display:block;">${"title"==t.key?t.match:t.value.title}</span>`,r=`
                        <span class="bp3-menu-item-label zotero-roam-search-item-key">
                        <a href="zotero://select/${t.value.location.startsWith("users")?"library":t.value.location}/items/${t.value.itemKey}" destination="zotero">${t.value.key}</a>
                        </span>
                        `,i=t.value.year?` (${t.value.year})`:"";let n="";t.value.authors&&(n="authorsString"==t.key||"year"==t.key?`<span class="zotero-roam-search-item-authors result_highlighted">${t.value.authors}${i}</span>`:`<span class="zotero-roam-search-item-authors">${zoteroRoam.utils.renderBP3Tag(t.value.authors+i,{modifier:"bp3-intent-primary"})}</span>`);let s="";t.value.tagsString&&(i="tagsString"==t.key?t.match:t.value.tagsString,s=`<span class="zotero-roam-search-item-tags bp3-text-muted" style="display:block;">${i}</span>`),e.innerHTML=`<div label="${t.value.key}" class="bp3-menu-item bp3-popover-dismiss">
                                            <div class="bp3-text-overflow-ellipsis bp3-fill zotero-roam-search-item-contents">
                                            ${a}
                                            <span class="zotero-roam-citation-metadata-contents">
                                            ${n}${o}
                                            ${s}
                                            </span>
                                            </div>
                                            ${r}
                                            </div>`}},events:{input:{blur:e=>{},focus:e=>{zoteroRoam.interface.clearSelectedItem(),zoteroRoam.librarySearch.autocomplete.start()},results:e=>{zoteroRoam.interface.clearSelectedItem(),0<e.detail.query.length&&0==e.detail.results.length&&(document.querySelector(".zotero-roam-library-results-count").innerHTML=`
                                <strong>No results</strong> for ${e.detail.query}
                                `)},selection:o=>{var a=o.detail;zoteroRoam.interface.search.input.blur(),document.querySelector(".zotero-roam-library-results-count").innerHTML="";o=document.querySelector("#zotero-roam-quick-copy-mode").checked;if(1==zoteroRoam.config.params.always_copy||o&&!zoteroRoam.config.params.override_quickcopy.overridden){let e=zoteroRoam.interface.search.overlay.querySelector("input.clipboard-copy-utility"),t="";if("citation"===zoteroRoam.config.params.quick_copy_format){let e=`${a.selection.value.authors||""}`;a.selection.value.year&&(e+=` (${a.selection.value.year})`),t=`[${e}]([[@${a.selection.value.key}]])`}else t=zoteroRoam.utils.formatItemReference(item=a.selection.value,format=zoteroRoam.config.params.quick_copy_format);e.value=t,e.select(),document.execCommand("copy"),o&&!zoteroRoam.config.params.override_quickcopy.overridden?zoteroRoam.interface.toggleSearchOverlay("hide"):zoteroRoam.interface.renderItemInPanel("@"+a.selection.value.key)}else zoteroRoam.interface.renderItemInPanel("@"+a.selection.value.key)}}}},citationsSearch:{data:{src:async function(){if(0==zoteroRoam.citations.currentDOI.length)return[];{let o=zoteroRoam.data.semantic.find(e=>e.doi==zoteroRoam.citations.currentDOI)[`${zoteroRoam.citations.currentType}`];var a=zoteroRoam.data.items.map(e=>zoteroRoam.utils.parseDOI(e.data.DOI)).filter(Boolean);return o.forEach((e,t)=>{e.doi&&zoteroRoam.utils.includes_anycase(a,e.doi)&&(o[t].inLibrary=!0)}),o}},keys:["year","title","authorsString","meta"],filter:e=>{return Array.from(new Set(e.map(e=>e.value.doi))).map(t=>e.filter(e=>e.value.doi==t).sort((t,o)=>zoteroRoam.config.citationsSearch.data.keys.findIndex(e=>e==t.key)<zoteroRoam.config.citationsSearch.data.keys.findIndex(e=>e==o.key)?-1:1)[0])}},selector:"#zotero-roam-citations-autocomplete",wrapper:!1,trigger:e=>0!=e.length||(zoteroRoam.interface.popCitationsOverlay(doi=zoteroRoam.citations.currentDOI,citekey=zoteroRoam.citations.currentCitekey,zoteroRoam.citations.currentType),!1),searchEngine:(e,t)=>zoteroRoam.utils.multiwordMatch(e,t),resultsList:!1,events:{input:{results:o=>{if(0<o.detail.results.length)zoteroRoam.citations.pagination=new zoteroRoam.Pagination({data:o.detail.results.map(e=>e.value)}),zoteroRoam.interface.renderCitationsPagination();else{let e=document.querySelector("#zotero-roam-citations-pagination");e.querySelector(".zotero-roam-citations-results-count").innerHTML=`
                                <strong>No results</strong> for ${o.detail.query}
                                `,zoteroRoam.citations.pagination=new zoteroRoam.Pagination({data:[]});let t=e.querySelector("ul");t.innerHTML=""}}}}},tagSelection:{data:{src:async function(t){let e=zoteroRoam.data.roamPages;var o=e.findIndex(e=>e.title==t);return-1==o?[{title:t,identity:"self"},...e]:(e[o].identity="self",e)},keys:["title"],filter:e=>e.sort((e,t)=>e.value.identity&&"self"==e.value.identity?-1e3:e.value.title.length-t.value.title.length)},selector:"#zotero-roam-tags-autocomplete",wrapper:!1,trigger:e=>0!=e.length||(zoteroRoam.tagSelection.autocomplete.close(),!1),searchEngine:(e,t)=>zoteroRoam.utils.multiwordMatch(e,t),placeHolder:"Add tags...",resultsList:{class:"zotero-roam-import-tags-list",id:"zotero-roam-import-tags-list",maxResults:20,element:(e,t)=>{if(e.classList.add("bp3-menu"),e.classList.add("bp3-elevation"),0<t.results.length)try{zoteroRoam.tagSelection.autocomplete.goTo(0)}catch(e){}}},events:{input:{blur:e=>{zoteroRoam.interface.citations.overlay.querySelector(`${zoteroRoam.config.tagSelection.selector}`).value="",zoteroRoam.tagSelection.autocomplete.close()},selection:e=>{e=e.detail;let t=zoteroRoam.interface.citations.overlay.querySelector(".options-tags_selection");t.innerHTML+=zoteroRoam.utils.renderBP3Tag(string=e.selection.value.title,{tagRemove:!0,tagAttribute:`data-tag="${e.selection.value.title}"`});let o=JSON.parse(t.dataset.tags);o.push(e.selection.value.title),t.dataset.tags=JSON.stringify(o),document.querySelector(`${zoteroRoam.config.tagSelection.selector}`).value=""}}}},tribute:{trigger:"",selectClass:"zotero-roam-tribute-selected",containerClass:"zotero-roam-tribute",lookup:"display",menuItemLimit:15,menuItemTemplate:e=>e.original.display,requireLeadingSpace:!0,selectTemplate:e=>e.original.value,searchOpts:{skip:!0},values:(t,e)=>{let o=zoteroRoam.handlers.getLibItems(format=zoteroRoam.config.params.autocomplete.format,display=zoteroRoam.config.params.autocomplete.display);e(o.filter(e=>e[zoteroRoam.config.tribute.lookup].toLowerCase().includes(t.toLowerCase())))}},params:{override_quickcopy:{overridden:!1},always_copy:!1,quick_copy_format:"citekey",autocomplete:{enabled:!1,format:"citation",display:"citekey"},citations:{itemsPerPage:20},notes:{use:"text",split_char:"\n",func:"zoteroRoam.utils.formatItemNotes"},pageMenu:{defaults:["addMetadata","importNotes","viewItemInfo","openZoteroLocal","openZoteroWeb","pdfLinks","sciteBadge","connectedPapers","semanticScholar","googleScholar","citingPapers"],trigger:e=>3<e.length},webimport:{tags:[]},theme:""},requests:[],shortcuts:[],userSettings:{},ref_checking:null,page_checking:null,tag_checking:null,auto_update:null,editingObserver:null},funcmap:{DEFAULT:"zoteroRoam.formatting.getItemMetadata"},typemap:{artwork:"Illustration",audioRecording:"Recording",bill:"Legislation",blogPost:"Blog post",book:"Book",bookSection:"Chapter",case:"Legal case",computerProgram:"Data",conferencePaper:"Conference paper",document:"Document",email:"Letter",encyclopediaArticle:"Encyclopaedia article",film:"Film",forumPost:"Forum post",hearing:"Hearing",instantMessage:"Instant message",interview:"Interview",journalArticle:"Article",letter:"Letter",magazineArticle:"Magazine article",manuscript:"Manuscript",map:"Image",newspaperArticle:"Newspaper article",patent:"Patent",podcast:"Podcast",presentation:"Presentation",radioBroadcast:"Radio broadcast",report:"Report",statute:"Legislation",thesis:"Thesis",tvBroadcast:"TV broadcast",videoRecording:"Recording",webpage:"Webpage"},addExtensionCSS(){let e=document.createElement("style");e.textContent=`
            .zotero-roam-search-backdrop, .zotero-roam-citations-search-backdrop {opacity:0.4;}
            .zotero-roam-dialog-overlay .bp3-dialog-container, .zotero-roam-dialog-small .bp3-dialog-container{justify-content:start;}
            .zotero-roam-dialog-overlay .bp3-dialog{margin-left: calc(20vw + 2.5%);padding-bottom:0px;box-shadow:none;}
            .zotero-roam-dialog-small .bp3-dialog{margin-left: calc(18vw + 9.5%);padding-bottom:0px;box-shadow:none;}
            .zotero-roam-dialog-overlay .bp3-dialog[side-panel="hidden"]{width:calc(95% - 40vw);}
            .zotero-roam-dialog-small .bp3-dialog[side-panel="hidden"]{width:calc(55% - 10vw);}
            .zotero-roam-dialog-overlay .bp3-dialog[side-panel="visible"]{width:calc(95% - 20vw);}
            .zotero-roam-dialog-overlay .bp3-dialog[side-panel="visible"] .side-panel{flex-basis:20vw!important;}
            .zotero-roam-dialog-small .bp3-dialog[side-panel="visible"]{width:calc(50% + 8vw);}
            .zotero-roam-dialog-small .bp3-dialog[side-panel="visible"] .side-panel{flex-basis:18vw!important;}
            #zotero-roam-portal .bp3-dialog[side-panel="hidden"] .side-panel{flex-basis:0%;}
            .zotero-roam-dialog-overlay .bp3-dialog .side-panel-contents{width:20vw;}
            .zotero-roam-dialog-small .bp3-dialog .side-panel-contents{width:18vw;}
            .zotero-roam-dialog-overlay .bp3-dialog .side-panel-contents .item-rendered-notes p{font-weight:350;}
            #zotero-roam-portal .bp3-dialog-body{flex-wrap:nowrap;display:flex;margin:0px;}
            #zotero-roam-portal .controls-top{display:flex;width:100%;justify-content:flex-end;}
            #zotero-roam-portal .header-content{width:97.5%;margin:0;margin-left:2.5%;display:flex;}
            #zotero-roam-portal h5.panel-tt{font-weight:600;display:inline-block;padding-right:15px;}
            #zotero-roam-portal h5.panel-tt[list-type="library"]{color:#137cbd;}
            #zotero-roam-portal h5.panel-tt[list-type="citations"]{color:#d9822b;}
            #zotero-roam-portal h5.panel-tt[list-type="references"]{color:#137cbd;}
            #zotero-roam-portal .bp3-dark h5.panel-tt[list-type="library"]{color:#48aff0;}
            #zotero-roam-portal .bp3-dark h5.panel-tt[list-type="citations"]{color:#ffb366;}
            #zotero-roam-portal .bp3-dark h5.panel-tt[list-type="references"]{color:#48aff0;}
            #zotero-roam-portal .header-left{flex: 0 1 66%;padding-top:10px;}
            #zotero-roam-portal .header-right{flex: 0 1 34%;}
            .zotero-roam-search-close{margin:0;padding:0;min-width:41px;}
            #zotero-roam-portal .panel-st{padding-bottom:10px;display:inline-block;margin-bottom:0px;}
            #zotero-roam-search-autocomplete{width:100%;margin-bottom:20px;padding: 0px 10px;}
            #zotero-roam-search-autocomplete, #zotero-roam-citations-autocomplete{padding:0px 10px;}
            #zotero-roam-portal .quick-copy-element{margin:10px;font-weight:600;display:inline-block;}
            #zotero-roam-portal .bp3-dialog-footer-actions{margin:10px 2.5%;}
            #zotero-roam-portal .side-panel{background-color:white;transition:0.5s;font-size:0.8em;overflow:auto;border-radius: 0 6px 6px 0;}
            #zotero-roam-portal .bp3-dark .side-panel{background-color:#30404d;}
            #zotero-roam-portal .side-panel > .side-panel-contents > *{padding:10px 20px;}
            li[aria-selected="true"]{background-color:#e7f3f7;}
            .bp3-dark li[aria-selected="true"]{background-color:#191919;}
            span.result_highlighted{color:#146cb7;font-weight:500;}
            .zotero-roam-citations-search-overlay .main-panel{width:100%;}
            #zotero-roam-citations-pagination > .bp3-button-group{margin:5px 0;}
            #zotero-roam-search-results-list, .zotero-roam-citations-search-results-list {max-height:70vh;overflow-y:scroll;}
            .zotero-roam-search-item-title{font-weight:600;font-size:0.9em;}
            .zotero-roam-search-item-tags{font-style:italic;display:block;}
            .zotero-roam-citation-link{padding: 0 5px;}
            .zotero-roam-citation-link a, .zotero-roam-citation-metadata-contents{font-size:0.85em;}
            .zotero-roam-citations-results-count, .zotero-roam-library-results-count{padding: 6px 10px;color:#5c7080;}
            .bp3-dark .zotero-roam-citations-results-count, .zotero-roam-library-results-count{color:#95a8b7;}
            .zotero-roam-search-results-list.bp3-menu, .zotero-roam-citations-search-results-list.bp3-menu{padding:0px;}
            .zotero-roam-search_result, .zotero-roam-citations-search_result{padding:3px;}
            .zotero-roam-citations-search_result[in-library="true"]{background-color:#e9f7e9;}
            .bp3-dark .zotero-roam-citations-search_result[in-library="true"]{background-color:#237d232e;}
            .zotero-roam-page-control > span[icon]{margin-right:0px;}
            #zotero-roam-library-rendered, #zotero-roam-citations-pagination {width:95%;margin: 0 auto;}
            #zotero-roam-library-rendered[view="search"] #zotero-roam-search-selected-item{display:none;}
            #zotero-roam-library-rendered[view="item"] #zotero-roam-library-search-div{display:none;}
            .selected-item-header, .selected-item-body{display:flex;justify-content:space-around;}
            .selected-item-header{margin-bottom:20px;}
            .selected-item-body{flex-wrap:wrap;}
            .item-basic-metadata, .item-additional-metadata{flex: 0 1 60%;}
            .item-abstract{padding:15px;background-color: #f5f8fa;font-weight:350;border-left-width:6px;}
            .bp3-dark .item-abstract, .bp3-dark  .zotero-roam-citation-abstract{background-color:#2b3135;}
            .item-metadata-string{font-size:0.85em;}
            .item-pdf-notes{margin-top: 25px;}
            .item-actions-additional{flex: 0 1 95%;margin-top:25px;}
            .item-citekey-section, .item-actions{flex:0 1 30%;}
            .item-actions > .bp3-card{background-color: #eff8ff;box-shadow:none;}
            .bp3-dark .item-actions > .bp3-card{background-color:#2b3135;}
            .item-in-graph{padding: 0 10px;}
            .item-citekey-section{margin:10px 0px; overflow-wrap:break-word;}
            .item-citekey-section .citekey-element{font-weight:bold;padding:0 10px;}
            .item-citekey-section .copy-buttons .bp3-button{font-size:0.7em;flex-wrap:wrap;}
            a.item-go-to-page[disabled]{pointer-events:none;opacity:0.5;}
            span.zotero-roam-sequence{background-color:#c79f0c;padding:3px 6px;border-radius:3px;font-size:0.85em;font-weight:normal;color:white;}
            .zotero-roam-tribute {max-width:800px;max-height:300px;overflow:scroll;margin-top:5px;}
            .zotero-roam-tribute ul {list-style-type:none;padding:0px;background-color: white;border:1px #e4e4e4 solid; border-radius:2px;}
            .zotero-roam-tribute ul li {padding: 2px 5px;font-weight:300;}
            .zotero-roam-tribute-selected {background-color: #4f97d4;color:white;}
            .zotero-roam-page-doi{margin:10px;display:block;font-weight:600;letter-spacing:0.3mm;}
            .zotero-roam-page-menu{justify-content:space-between;border-width:0px;padding:5px;border-radius:5px;background-color: #f8f8f9;box-shadow:none;}
            .zotero-roam-page-menu-header{display:flex;}
            .zotero-roam-page-menu-actions{flex-wrap:wrap;}
            .zotero-roam-page-menu hr{margin:2px 0;}
            .scite-badge{padding-top:5px;min-width:25%;}
            .scite-badge[style*='position: fixed; right: 1%;'] {display: none!important;}
            .zotero-roam-page-menu-pdf-link, .item-pdf-link{font-weight:600;text-align:left!important;}
            .zotero-roam-page-menu-citations{display:flex;padding:5px;flex-wrap:wrap;padding-bottom:0px;border-top: 1px #f1f1f1 solid;}
            .bp3-dark .zotero-roam-page-menu-citations{border-top-color:#f1f1f12e;}
            .zotero-roam-page-menu-citations > button{flex: 1 0 33%;}
            .zotero-roam-page-menu-backlinks-list {width:100%;}
            .zotero-roam-page-menu-backlinks-list > ul{padding:1vw;display:flex;flex:1 0 50%;flex-direction:column;}
            .zotero-roam-page-menu-backlinks-total, .zotero-roam-page-menu-references-total {font-weight: 700;}
            .zotero-roam-citations-search_result > .bp3-menu-item, .zotero-roam-search_result > .bp3-menu-item {flex-wrap:wrap;justify-content:space-between;user-select:initial;}
            .zotero-roam-citations-search_result > .bp3-menu-item:hover, .zotero-roam-list-item > .bp3-menu-item:hover{background-color:unset;cursor:unset;}
            .zotero-roam-citation-metadata, .zotero-roam-search-item-contents{flex: 0 2 77%;white-space:normal;}
            .zotero-roam-citation-links-list{display:block;}
            .zotero-roam-search-item-key{flex: 0 1 20%;text-align:right;}
            .zotero-roam-search-item-key .zotero-roam-citation-identifier-link {display:block;}
            .zotero-roam-search-item-key a, .zotero-roam-search-item-key button, .zotero-roam-list-item-actions button, .zotero-roam-list-item-actions a{font-size:0.8em;overflow-wrap:break-word;}
            .zotero-roam-citation-toggle-abstract{font-size:0.8em;overflow-wrap:break-word;}
            .zotero-roam-citation-abstract{font-size:0.88em;padding:5px 10px;flex:0 1 100%;background-color:#f5f8fa;white-space:break-spaces;}
            .import-header{display:flex;justify-content:space-between;align-items:center;padding:10px 5px!important;margin-bottom:20px;}
            .import-options{display:flex;justify-content:space-between;flex-wrap:wrap;}
            .options-library-list, .options-collections-list{flex:1 0 50%;}
            .options-collections-list {max-height: 50vh;overflow-y:scroll;}
            .options-collections-list::-webkit-scrollbar {width:0.2em;}
            .options-collections-list label{font-weight:400;margin-left:40px;font-size:0.8em;margin-bottom:0px;}
            .options-collections-list label[data-option-depth="0"]{margin-left:0px;}
            .options-collections-list label[data-option-depth="1"]{margin-left:20px;}
            .options-library-list label{font-weight:600;}
            .options-tags{padding:20px 0px;flex: 1 0 100%;flex-wrap:wrap;display:flex;}
            .options-tags-select{flex: 1 0 50%;}
            .options-tags_selection{flex: 1 0 50%;padding:0px 8px;}
            .options-tags_selection .bp3-tag{word-break:break-word;}
            #zotero-roam-tags-autocomplete{box-shadow:none;background:none;}
            .zotero-roam-import-tags-list{position:fixed;max-width:calc(20vw - 40px);z-index:20;border:1px #e1eeff solid;max-height:250px;overflow:scroll;}
            .zotero-roam-import-tags-list > li{padding:3px 5px;}
            li.import-items_selected, li.related-item_listed{display:flex;justify-content:space-between;background:#f9fafb;}
            .bp3-dark li.import-items_selected, .bp3-dark li.related-item_listed{background:#2e2f3187;}
            li.import-items_selected{padding:5px 0 5px 15px;}
            li.related-item_listed{padding:0 0 0 15px;border-left-width:0px;background:#f1f1f1;}
            .selected_title{font-weight:500;}
            .selected_origin{display:block;font-weight:300;}
            .selected_info, .related_info{flex: 0 1 90%;}
            .related_info{display:flex;}
            .related_info > *{padding:6px 0px;font-size:0.9em;}
            .related_info .bp3-icon{margin-right:5px;}
            .selected_state, .related_state{flex: 1 0 10%;}
            .selected_state {text-align:center;}
            .related_state {text-align:right;align-self:stretch;}
            .related_state button {height:100%;}
            [item-type="reference"] .bp3-icon, [item-type="reference"] a {color:#7ec8de!important;}
            .bp3-dark [item-type="citation"] .bp3-icon, .bp3-dark [item-type="citation"] a {color:#bf7326!important}
            [item-type="citation"] .bp3-icon, [item-type="citation"] a {color:#e09f26!important;}
            .zotero-roam-page-related{opacity:0.6;float:right;margin-top:-40px;}
            .roam-body.mobile .zotero-roam-page-related{float:none;margin-top:0px;}
            .zotero-roam-item-timestamp{font-size:0.85em;}
            .zotero-roam-list-item [in-graph="true"] .zotero-roam-search-item-title {color:#7AC07A;}
            .zotero-roam-list-item .zotero-roam-item-contents{flex:0 1 100%;}
            .zotero-roam-auxiliary-overlay .bp3-card{padding:5px;}
            .zotero-roam-list-item > .bp3-menu-item{flex-wrap:nowrap;user-select:initial;}
            .zotero-roam-list-item-actions{text-align:right;flex: 0 0 20%;}
            .zotero-roam-auxiliary-overlay .zotero-roam-list-item-actions button, .zotero-roam-auxiliary-overlay .zotero-roam-list-item-actions a{opacity:0.6;}
            .zotero-roam-list-item-key {padding:0 5px;font-size:0.85em;}
            .zotero-roam-auxiliary-overlay .bp3-card ul.bp3-list-unstyled {padding:15px 0;}
            .zotero-roam-explo-import{position:absolute;right:0px;opacity:0.7;z-index:10;}
            .zr-explo-list-item .bp3-menu-item{flex-wrap:wrap;}
            .zr-explo-title{flex:1 0 100%;}
            .zr-explo-title .bp3-checkbox{margin-bottom:0px;}
            .zr-explo-list-item .zotero-roam-item-contents{padding-left:30px;}
            `,document.head.append(e)}};var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.1.5/dist/autoComplete.js",e.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(e),void 0===window.Tribute&&((t=document.createElement("script")).src="https://cdn.jsdelivr.net/npm/tributejs@5.1.3",t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t));var t=document.createElement("script");t.src="https://cdn.scite.ai/badge/scite-badge-latest.min.js",t.type="application/javascript",t.async=!0,document.getElementsByTagName("head")[0].appendChild(t)})(),zoteroRoam.utils={addBlock(e,t,o=0,a={}){var r=window.roamAlphaAPI.util.generateUID();let i={string:t,uid:r};if(0<Object.keys(a).length)for(k of Object.keys(a))["children-view-type","alignment","heading"].includes(k)&&(i[k]=a[k]);return window.roamAlphaAPI.createBlock({location:{"parent-uid":e,order:o},block:i}),r},escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},executeFunctionByName(e,t){for(var o=Array.prototype.slice.call(arguments,2),a=e.split("."),r=a.pop(),i=0;i<a.length;i++)t=t[a[i]];return t[r].apply(t,o)},findCommonTags(t,{exclude_attachments:e=!0,excluded_tags:o=[],more_than:a=0}={}){let r=t.data.tags.map(e=>e.tag.toLowerCase()).filter(e=>!o.includes(e)),i=1==e?zoteroRoam.data.items.filter(e=>!["attachment","note","annotation"].includes(e.data.itemType)):zoteroRoam.data.items;return i=i.filter(e=>e.key!=t.key),i.map(e=>{let t=e.data.tags.map(e=>e.tag.toLowerCase()),o=0,a=[];return t.forEach(e=>{r.includes(e)&&(o+=1,a.push(e))}),{item:e,proximity:o,commons:a}}).filter(e=>e.proximity>a)},findSameDay(t,{exclude_attachments:e=!0}={}){let o=zoteroRoam.data.items.filter(e=>new Date(e.data.dateAdded).toDateString()==t.toDateString());return 0==o.length?[]:1==e?o.filter(e=>!["attachment","annotation","note"].includes(e.data.itemType)):o},formatBib(e){e=e.match('csl-entry">(.+)</div>')[1];let t=document.createElement("textarea");t.innerHTML=e;let o=t.innerText;o=o.replaceAll(/<\/?i>/g,"__");return o=o.replaceAll(/<a href="(.+)">(.+)<\/a>/g,"[$2]($1)"),o},splitNotes(e,t=zoteroRoam.config.params.notes.split_char){return 0!=e.length&&e.map(e=>e.data.note.split(t))},formatItemNotes(e){return e.flat(1).map(e=>zoteroRoam.utils.parseNoteBlock(e)).filter(e=>e.trim())},formatItemReference(o,a){switch(a){case"tag":return`#[[@${o.key}]]`;case"pageref":return`[[@${o.key}]]`;case"citation":let e=o.meta.creatorSummary||"";return e=o.meta.parsedDate?`${e} (${new Date(o.meta.parsedDate).getUTCFullYear()})`:e,e=`[${0<e.length?e:o.key}]([[@${o.key}]])`,e;case"popover":let t=o.meta.creatorSummary||"";return t=o.meta.parsedDate?`${t} (${new Date(o.meta.parsedDate).getUTCFullYear()})`:t,t=`{{=: ${0<t.length?t:o.key} | {{embed: [[@${o.key}]]}} }}`,t;case"zettlr":return(o.meta.creatorSummary||"")+(o.meta.parsedDate?` (${new Date(o.meta.parsedDate).getUTCFullYear()})`:"")+" : "+o.data.title;case"zettlr_accent":return"<strong>"+(o.meta.creatorSummary||"")+(o.meta.parsedDate?` (${new Date(o.meta.parsedDate).getUTCFullYear()})`:"")+"</strong>"+" : "+o.data.title;case"citekey":default:return`@${o.key}`}},getRoamPages(){return roamAlphaAPI.q("[:find [(pull ?e [:node/title])...] :where[?e :node/title ?t]]")},getAllRefPages(){return roamAlphaAPI.q('[:find [(pull ?e [:node/title :block/uid])...] :where[?e :node/title ?t][(clojure.string/starts-with? ?t "@")]]')},getItemPrefix(e){return`${e.library.type}s/${e.library.id}`},getTopBlockData(e){var t=window.roamAlphaAPI.q("[:find ?bUID ?bText :in $ ?pUID :where[?b :block/uid ?bUID][?b :block/string ?bText][?b :block/order 0][?p :block/children ?b][?p :block/uid ?pUID]]",e);if(void 0===t||null==t||0==t.length)return!1;try{return{uid:t[0][0],text:t[0][1]}}catch(e){console.error(e)}},getLibraries(){return zoteroRoam.data.libraries.map(t=>{var e=zoteroRoam.data.keys.find(e=>e.key==t.apikey).access,[o,a]=t.path.split("/");let r={};"users"==o?r=e.user||{}:e.groups?r=Object.keys(e.groups).includes(a)?e.groups[a]:e.groups.all:console.log(e);e=zoteroRoam.data.collections.filter(e=>zoteroRoam.utils.getItemPrefix(e)==t.path);return{name:0<(e=zoteroRoam.utils.sortCollectionsList(e)).length?e[0].library.name:t.path,apikey:t.apikey,path:t.path,writeable:r.write||!1,collections:e,version:t.version}})},includes_anycase(e,t){return e.join("\n").toLowerCase().split("\n").includes(t.toLowerCase())},lookForPage(e){let t=null;e=window.roamAlphaAPI.q("[:find ?uid :in $ ?title :where[?p :block/uid ?uid][?p :node/title ?title]]",e);return t=0<e.length?{present:!0,uid:e[0][0]}:{present:!1},t},makeTimestamp(e){let t=e.constructor===Date?e:new Date(e);return`${t.getHours()}:${("0"+t.getMinutes()).slice(-2)}`},makeDNP(e,{brackets:t=!0}={}){e=`${["January","February","March","April","May","June","July","August","September","October","November","December"][(e=e.constructor!==Date?new Date(e):e).getMonth()]} ${zoteroRoam.utils.makeOrdinal(e.getDate())}, ${e.getFullYear()}`;return t?`[[${e}]]`:e},readDNP(e){var[,t,o,e]=Array.from(e.matchAll(/(.+) ([0-9]+).{2}, ([0-9]{4})/g))[0];return new Date(parseInt(e),["January","February","March","April","May","June","July","August","September","October","November","December"].findIndex(e=>e==t),parseInt(o))},makeMetaString(e){let t="";var o=[e.data.publicationTitle,e.data.university,e.data.bookTitle].filter(Boolean);return 0<o.length&&(t+=` ${o[0]}`),e.data.publisher&&(t+=`, ${e.data.publisher}`,e.data.place&&(t+=`: ${e.data.place}`)),e.data.volume&&(t+=`, ${e.data.volume}`,e.data.issue&&(t+=`(${e.data.issue})`)),t+=e.data.pages?`, ${e.data.pages}.`:".",t},makeOrdinal(e){var t=e%10;return 1==t&11!=e?e+"st":2==t&12!=e?e+"nd":3==t&13!=e?e+"rd":e+"th"},makeLinkToPDF(e){var t="group"==e.library.type?`groups/${e.library.id}`:"library";return["linked_file","imported_file","imported_url"].includes(e.data.linkMode)?`[${e.data.filename||e.data.title}](zotero://open-pdf/${t}/items/${e.data.key})`:`[${e.data.title}](${e.data.url})`},makePDFLinks(e){return e.constructor===Array&&0<e.length?e.map(e=>zoteroRoam.utils.makeLinkToPDF(e)):e.constructor===Object&&zoteroRoam.utils.makeLinkToPDF(e)},matchArrays(e,t){return 0<e.filter(e=>t.includes(e)).length},multiwordMatch(e,t){var o=e.toLowerCase().split(" ");let a=t.toLowerCase(),r=!1;for(let e=0;e<o.length;e++){if(!a.includes(o[e])){r=!1;break}r=!0,a=a.replace(o[e],"")}if(r)return t},addToSidebar(e,t="outline"){window.roamAlphaAPI.ui.rightSidebar.addWindow({window:{type:t,"block-uid":e}})},parseDOI(e){if(e){e=e.match(/10\.([0-9]+?)\/(.+)/g);return!!e&&e[0]}return!1},parseNoteBlock(e){let t=e;var o={"</p>":"","</div>":"","</span>":"","<blockquote>":"> ","</blockquote>":"","<strong>":"**","</strong>":"**","<em>":"__","</em>":"__","<b>":"**","</b>":"**","<br />":"\n","<br>":"\n","<u>":"","</u>":""};for(prop in o)t=t.replaceAll(`${prop}`,`${o[prop]}`);["p","div","span","h1","h2","h3"].forEach(e=>{e=new RegExp(`<${e}>|<${e} .+?>`,"g");t=t.replaceAll(e,"")});return t=t.replaceAll(/<a href="(.+?)">(.+?)<\/a>/g,"[$2]($1)"),t=zoteroRoam.utils.cleanNewlines(t),t},parseSemanticItem(e){let t={doi:e.doi,intent:e.intent,isInfluential:e.isInfluential,links:{},meta:e.venue.split(/ ?:/)[0],title:e.title,url:e.url||"",year:e.year?e.year.toString():""};switch(t.authorsLastNames=e.authors.map(e=>{let t=e.name.replaceAll("."," ").split(" ").filter(Boolean);return 1==t.length?t[0]:t.slice(1).filter(e=>1<e.length).join(" ")}),t.authorsString=t.authorsLastNames.join(" "),t.authorsLastNames.length){case 0:t.authors="";break;case 1:t.authors=t.authorsLastNames[0];break;case 2:t.authors=t.authorsLastNames[0]+" & "+t.authorsLastNames[1];break;case 3:t.authors=t.authorsLastNames[0]+", "+t.authorsLastNames[1]+" & "+t.authorsLastNames[2];break;default:t.authors=t.authorsLastNames[0]+" et al."}return e.paperId&&(t.links.semanticScholar=`https://www.semanticscholar.org/paper/${e.paperId}`),e.arxivId&&(t.links.arxiv=`https://arxiv.org/abs/${e.arxivId}`),e.doi&&(t.links.connectedPapers=`https://www.connectedpapers.com/api/redirect/doi/${e.doi}`,t.links.googleScholar=`https://scholar.google.com/scholar?q=${e.doi}`),t},cleanNewlines(e){let t=e;return t.startsWith("\n")?(t=t.slice(1),t=zoteroRoam.utils.cleanNewlines(t)):t.endsWith("\n")&&(t=t.slice(0,-1),t=zoteroRoam.utils.cleanNewlines(t)),t},renderBP3Button_link(e,{linkClass:t="",icon:o="",iconModifier:a="",target:r="",linkAttribute:i=""}={}){return`
            <a class="bp3-button ${t}" href="${r}" ${i}>
            ${o?`<span icon="${o}" class="bp3-icon bp3-icon-${o} ${a}"></span>`:""}
            <span class="bp3-button-text">${e}</span>
            </a>
            `},renderBP3Button_group(e,{buttonClass:t="",icon:o="",modifier:a="",buttonAttribute:r=""}={}){return`
            <button type="button" class="bp3-button ${t}" ${r}>
            ${o?`<span icon="${o}" class="bp3-icon bp3-icon-${o} ${a}"></span>`:""}
            ${""==e?"":`<span class="bp3-button-text">${e}</span>`}
            </button>
            `},renderBP3ButtonGroup(e,{divClass:t="bp3-minimal bp3-fill bp3-align-left",buttonClass:o="",modifier:a="",icon:r="",buttonModifier:i=""}={}){return`<div class="bp3-button-group ${t}">
                        ${zoteroRoam.utils.renderBP3Button_group(e,{buttonClass:o,icon:r,modifier:a,buttonAttribute:i})}
                    </div>`},renderBP3_list(e,a,{varName:r,has_value:i,has_string:n,optClass:s="",selectFirst:l=!1,active_if:c=""}={}){return e.map((e,t)=>{let o="";return c&&(o=e[c]?"":"disabled",s+=e[c]?"":"bp3-disabled"),l&&0==t&&""==o&&(o="checked"),zoteroRoam.utils.renderBP3_option(string=e[n],a,depth=e.depth||0,{varName:r,optClass:s,modifier:o,optValue:e[i]})}).join("\n")},renderBP3_option(e,t,o,{varName:a,optClass:r="",modifier:i="",optValue:n=""}={}){return`
            <label class="bp3-control bp3-${t} ${r}" data-option-depth="${o}">
                <input type="${t}" name="${a}" value="${n}" ${i} />
                <span class="bp3-control-indicator"></span>
                ${e}
            </label>
            `},renderBP3Tag(e,{modifier:t="",icon:o="",tagRemove:a=!1,tagAttribute:r=""}={}){a=a?'<button class="bp3-tag-remove"></button>':"";return 0<o.length?`<span class="bp3-tag bp3-minimal ${t}" ${r}><span icon="${o}" class="bp3-icon bp3-icon-${o}"></span><span class="bp3-text-overflow-ellipsis bp3-fill">${e}</span>${a}</span>`:`<span class="bp3-tag bp3-minimal ${t}" style="margin:3px;" ${r}>${e}${a}</span>`},renderBP3Toast(e,{toastClass:t="",style:o="opacity:0;top:20px;transition: opacity 0.3s ease-out, top 0.3s ease-in;"}={}){return`
            <div class="bp3-toast ${t} bp3-overlay-content" tabindex="0" style="${o}">
            <span class="bp3-toast-message">${e}</span>
            </div>
            `},renderHTMLBlockObject(e){let t="";if(void 0===e.string)throw console.log(e),new Error("All blocks passed as an Object must have a string property");return t+=`<li>${e.string}`,void 0!==e.children&&0<e.children.length&&(t+=zoteroRoam.utils.renderHTMLMetadataArray(e.children)),t+=" </li>",t},renderHTMLMetadataArray(e){let t="<ul>";return e.forEach(e=>{if(e.constructor===Object)t+=zoteroRoam.utils.renderHTMLBlockObject(e);else{if(e.constructor!==String)throw console.log(e),new Error("All array items should be of type String or Object");t+=`<li>${e} </li>`}}),t+="</ul>",t},renderPageReference(e,t){return`<span data-link-title="${e}" data-link-uid="${t}">
            <span tabindex="-1" class="rm-page-ref rm-page-ref--link">${e}</span></span>`},renderPageTag(e){return`<span tabindex="-1" data-tag="${e}" class="rm-page-ref rm-page-ref--tag">#${e}</span>`},searchEngine(e,t,{any_case:o=!0,word_order:a="strict",match:r="partial",search_compounds:i=!0}={}){let n=e,s=t;1!=o||n.match(/[A-Z]{2}/g)||(n=e.toLowerCase(),s=t.toLowerCase());let l=n.split(" "),c=!1;if(l.forEach(e=>{e.includes("-")&&(c=!0)}),1==l.length){let e=n;if(c&&1==i&&(e=n.replace("-","(?: |-)?")),"partial"==r){var m=new RegExp(e,"g");return!!s.match(m)}m=new RegExp("(?:\\W|^)"+e+"(?:\\W|$)","g");return!!s.match(m)}{let o=l;if(1==i&&(c?o=l.map(e=>e.includes("-")?e.replace("-","(?: |-)?"):e):c||"strict"!=a||(o=[l.join("(?: |-)?")])),"loose"==a){let e=o.map(e=>"(?:\\W|^)"+e+"(?:\\W|$)"),t=!0;return e.forEach(e=>{e=new RegExp(e,"g");s.match(e)||(t=!1)}),t}a=new RegExp("(?:\\W|^)"+o.join(" ")+"(?:\\W|$)","g");return!!s.match(a)}},setNativeValue(e,t){const o=Object.getOwnPropertyDescriptor(e,"value").set;var a=Object.getPrototypeOf(e);const r=Object.getOwnPropertyDescriptor(a,"value").set;(o&&o!==r?o:r).call(e,t)},sleep(t){return new Promise(e=>setTimeout(e,t))},sortCollectionChildren(e,o,a=0){let r=e;if(r.depth=a,0<o.length){var i=o.filter(e=>e.data.parentCollection==r.key);if(i){let t=[r];for(let e=0;e<i.length;e++)t.push(...zoteroRoam.utils.sortCollectionChildren(i[e],o,a+1));return t}return[r]}return[r]},sortCollectionsList(a){if(0<a.length){a=a.sort((e,t)=>e.data.name.toLowerCase()<t.data.name.toLowerCase()?-1:1);let e=[],o=a.filter(e=>!e.data.parentCollection);o.forEach((e,t)=>{o[t].depth=0});let t=a.filter(e=>e.data.parentCollection);for(k=0;k<o.length;k++)t.filter(e=>e.data.parentCollection==o[k].key)?e.push(...zoteroRoam.utils.sortCollectionChildren(parent=o[k],children=t,depth=0)):e.push(o[k]);return e}return[]}},zoteroRoam.handlers={addBlockObject(e,t){let{string:o,children:a,...r}=t;if(void 0===o)throw console.log(t),new Error("All blocks passed as an Object must have a string property");var i=zoteroRoam.utils.addBlock(uid=e,o,order=0,r);if(void 0!==a)for(let e=a.length-1;0<=e;e--)if(a[e].constructor===Object)zoteroRoam.handlers.addBlockObject(i,a[e]);else{if(a[e].constructor!==String)throw new Error("All children array items should be of type String or Object");zoteroRoam.utils.addBlock(uid=i,o=a[e],order=0)}},addMetadataArray(e,t){if(0<t.length){for(k=t.length-1;0<=k;k--)if(t[k].constructor===Object)zoteroRoam.handlers.addBlockObject(e,t[k]);else{if(t[k].constructor!==String)throw console.log(t[k]),new Error("All array items should be of type String or Object");zoteroRoam.utils.addBlock(uid=e,blockString=t[k],order=0)}return{success:!0}}return console.log("The metadata array was empty ; nothing was done."),{success:!1}},async importItemMetadata(t,o,{popup:a=!0}={}){var r=t.replace("@",""),e=zoteroRoam.data.items.find(e=>e.key==r),i=await zoteroRoam.handlers.formatData(e);let n={},s=o||"";if(e&&0<i.length){n=o?zoteroRoam.handlers.addMetadataArray(page_uid=o,arr=i):(s=window.roamAlphaAPI.util.generateUID(),window.roamAlphaAPI.createPage({page:{title:t,uid:s}}),zoteroRoam.handlers.addMetadataArray(page_uid=s,arr=i));o=n.success?"Metadata was successfully added.":"The metadata array couldn't be properly processed.";let e=n.success?"success":"danger";1==a?zoteroRoam.interface.popToast(message=o,e):console.log(o)}else console.log(e),console.log(i),zoteroRoam.interface.popToast(message="Something went wrong when formatting or importing the item's data.",intent="danger");zoteroRoam.events.emit("metadata-added",{success:n.success,uid:s,title:t,item:e,meta:i})},addItemNotes(t,a,{popup:r=!0}={}){var o=t.startsWith("@")?t.slice(1):t,i=zoteroRoam.data.items.find(e=>e.key==o);try{var n=zoteroRoam.formatting.getItemChildren(i,{pdf_as:"raw",notes_as:"formatted",split_char:split_char=zoteroRoam.config.params.notes.split_char}).notes;let e={},o=a||"";if(a)e=zoteroRoam.handlers.addMetadataArray(page_uid=a,arr=[{string:"[[Notes]]",children:n}]);else{o=window.roamAlphaAPI.util.generateUID(),window.roamAlphaAPI.createPage({page:{title:t,uid:o}}),e=zoteroRoam.handlers.addMetadataArray(page_uid=o,arr=[{string:"[[Notes]]",children:n}]);try{let e=document.querySelector(".item-in-graph");null!=e&&(e.innerHTML='<span class="bp3-icon-tick bp3-icon bp3-intent-success"></span><span> In the graph</span>');let t=document.querySelector(".item-go-to-page");null!=t&&(t.setAttribute("data-uid",o),t.disabled=!1)}catch(e){}}var s=e.success?"Notes successfully imported.":"The notes couldn't be imported.",l=e.success?"success":"danger";1==r?zoteroRoam.interface.popToast(s,l):console.log(s),zoteroRoam.events.emit("notes-added",{success:e.success,uid:o,title:t,item:i,notes:n})}catch(e){console.error(e),console.log(i),console.log(itemChildren)}},extractCitekeys(e){return e.map(e=>(void 0!==e.data.extra&&e.data.extra.includes("Citation Key: ")&&(e.key=e.data.extra.match("Citation Key: (.+)")[1]),e))},async fetchData(r,n,t){var o=`https://api.zotero.org/${n}?${t}`;let s=[];try{let e=await fetch(o,{method:"GET",headers:{"Zotero-API-Version":3,"Zotero-API-Key":r}});if(1==e.ok){var l=e.headers.get("Total-Results");let a=new URLSearchParams(t);var c=a.has("start")?Number(a.get("start")):0,m=a.has("limit")?Number(a.get("limit")):100;s=await e.json();var d=c+s.length;if(d<l){var p=Math.ceil((l-d)/m);let e=[];for(i=1;i<=p;i++){var u=d+m*(i-1);a.set("start",u),a.set("limit",m),e.push(fetch(`https://api.zotero.org/${n}?${a.toString()}`,{method:"GET",headers:{"Zotero-API-Version":3,"Zotero-API-Key":r}}))}let t=await Promise.all(e),o=await Promise.all(t.map(e=>e.json()));o=o.flat(1),s.push(...o)}}else console.log(`The request for ${e.url} returned a code of ${e.status}`)}catch(e){console.error(e),zoteroRoam.interface.popToast("The extension encountered an error while requesting Zotero data. Please check the console for details.","danger")}finally{return{data:s}}},async formatData(e){var t=e.data.itemType;let o=zoteroRoam.funcmap.DEFAULT;zoteroRoam.config.userSettings.funcmap&&(o=zoteroRoam.config.userSettings.funcmap[`${t}`]||zoteroRoam.config.userSettings.funcmap.DEFAULT||o);try{return await zoteroRoam.utils.executeFunctionByName(o,window,e)}catch(e){return console.error(e),console.log(`There was a problem when formatting the item with function ${o}`),[]}},formatNotes(e,t=zoteroRoam.config.params.notes.use,o=zoteroRoam.config.params.notes.split_char){let a=[];var r=zoteroRoam.config.params.notes.func;try{switch(t){case"raw":return a=zoteroRoam.utils.executeFunctionByName(r,window,e),a;case"text":var i=zoteroRoam.utils.splitNotes(e,o);return a=zoteroRoam.utils.executeFunctionByName(r,window,i),a;default:console.error(`Unsupported format : ${t}`)}}catch(e){return console.error(e),console.log(`There was a problem when formatting the item with function ${r}`),[]}},setupUserRequests(){if(!zoteroRoam.config.userSettings.dataRequests)throw new Error("At least one data request object needs to be specified in order to use the extension. Read through the docs for basic setup examples.");{let e=zoteroRoam.config.userSettings.dataRequests;e=e.constructor===Array?e:[e];var n=e.find(e=>void 0!==e.apikey).apikey,s=e.find(e=>void 0!==e.params).params;e=e.map((e,t)=>{let{name:o=`${t}`,apikey:a=n,dataURI:r,params:i=s}=e;return{apikey:a,dataURI:r,params:i,name:o,library:r.match(/(users|groups)\/(.+?)\//g)[0].slice(0,-1)}});let t=Array.from(new Set(e.map(e=>e.library)));zoteroRoam.data.libraries=t.map(t=>({path:t,version:"0",apikey:e.find(e=>e.library==t).apikey})),zoteroRoam.config.requests=e}},async checkForScitations(e){try{var t=e.parentElement.dataset.linkTitle.replace("@",""),o=zoteroRoam.data.items.find(e=>e.key==t);o&&(o.data.DOI?0==(await zoteroRoam.handlers.requestScitations(o.data.DOI)).simplified.length?zoteroRoam.interface.popToast("This item has no available citing papers"):zoteroRoam.interface.popCitationsOverlay(o.data.DOI,t):zoteroRoam.interface.popToast("This item has no DOI (required for citations lookup).","danger"))}catch(e){console.error(e)}},async checkForSemantic_citations(e){try{var t,o=e.parentElement.dataset.linkTitle.replace("@",""),a=zoteroRoam.data.items.find(e=>e.key==o);a&&((t=zoteroRoam.utils.parseDOI(a.data.DOI))?(a=await zoteroRoam.handlers.getSemantic(t)).citations?0==a.citations.length?zoteroRoam.interface.popToast("This item has no available citing papers"):zoteroRoam.interface.popCitationsOverlay(t,o,type="citations"):zoteroRoam.interface.popToast("No data could be retrieved.","danger"):zoteroRoam.interface.popToast("This item has no DOI (required for citations lookup).","danger"))}catch(e){console.error(e)}},async checkForSemantic_references(e){try{var t,o=e.parentElement.dataset.linkTitle.replace("@",""),a=zoteroRoam.data.items.find(e=>e.key==o);a&&((t=zoteroRoam.utils.parseDOI(a.data.DOI))?(a=await zoteroRoam.handlers.getSemantic(t)).references?0==a.references.length?zoteroRoam.interface.popToast("This item has no available references"):zoteroRoam.interface.popCitationsOverlay(t,o,type="references"):zoteroRoam.interface.popToast("No data could be retrieved.","danger"):zoteroRoam.interface.popToast("This item has no DOI (required for references lookup).","danger"))}catch(e){console.error(e)}},async importSelectedWeblinks(){let e=document.querySelector('[zr-import="weblinks"]'),t={};var o=zoteroRoam.activeImport.currentLib,a=Array.from(e.querySelectorAll('.options-collections-list [name="collections"]')).filter(e=>e.checked).map(e=>e.value);let r=[],i=Array.from(e.querySelectorAll('[name="explo-weblink"]')).filter(e=>e.checked),n=i.map(e=>zoteroRoam.webImport.activeImport.harvest[Number(e.getAttribute("value"))]);n.forEach((e,t)=>{n[t].collections=a,n[t].tags=r.map(e=>({tag:e}))}),t.harvest=n,t.write=await zoteroRoam.write.importItems(n,o),t.write.identifiers=i,zoteroRoam.events.emit("write",{collections:a,identifiers:i,library:o,tags:r,outcome:t,context:{block:zoteroRoam.webImport.currentBlock}})},async importSelectedItems(){let e={};var t=zoteroRoam.activeImport.currentLib,o=Array.from(zoteroRoam.interface.citations.overlay.querySelectorAll('.options-collections-list [name="collections"]')).filter(e=>e.checked).map(e=>e.value);let a=zoteroRoam.citations.activeImport.items;var r=zoteroRoam.interface.citations.overlay.querySelector(".options-tags_selection").dataset.tags,r=JSON.parse(r);let i=[];a.forEach(e=>{i.push(zoteroRoam.handlers.requestCitoid(query=e,{collections:o,tag_with:r}))}),e.harvest=await Promise.all(i);let n={identifiers:[],data:[]};return e.harvest.forEach(e=>{1==e.success&&(n.identifiers.push(e.query),n.data.push(e.data))}),e.write=await zoteroRoam.write.importItems(n.data,t),e.write.identifiers=n.identifiers,zoteroRoam.events.emit("write",{collections:o,identifiers:a,library:t,tags:r,outcome:e,context:{doi:zoteroRoam.citations.currentDOI,key:zoteroRoam.citations.currentCitekey,type:zoteroRoam.citations.currentType}}),console.log(e),e},async requestCitoid(t,{format:o="zotero",has_relation:a=!1,tag_with:r=[],collections:i=[]}={}){let n={};try{let e=await fetch(`https://en.wikipedia.org/api/rest_v1/data/citation/${o}/${encodeURIComponent(t)}`,{method:"GET"});var s,l,c;n=1==e.ok?({key:s,version:l,...c}=(await e.json())[0],c.collections=i,c.tags=r.map(e=>({tag:e})),c.relations={},0!=a&&(c.relations.dc_relation=`http://zotero.org/${zoteroRoam.utils.getItemPrefix(a)}/items/${a.data.key}`),{query:t,success:!0,data:c}):(console.log(`The request for ${e.url} returned a code of ${e.status}`),{query:t,success:!1,response:e})}catch(e){n={query:t,success:null,error:e}}finally{return n}},async getSemantic(t){var e=zoteroRoam.data.semantic.findIndex(e=>e.doi==t);if(-1!=e)return zoteroRoam.data.semantic[e];{let o=await zoteroRoam.handlers.requestSemantic(t);if(1!=o.success)return console.log(o),{};var a=zoteroRoam.data.items.map(e=>zoteroRoam.utils.parseDOI(e.data.DOI)).filter(Boolean);return o.data.citations.forEach((e,t)=>{e.doi&&zoteroRoam.utils.includes_anycase(a,e.doi)&&(o.data.citations[t].inLibrary=!0)}),o.data.references.forEach((e,t)=>{e.doi&&zoteroRoam.utils.includes_anycase(a,e.doi)&&(o.data.references[t].inLibrary=!0)}),zoteroRoam.data.semantic.push(o.data),o.data}},async requestSemantic(o){let a={};try{let t=await fetch(`https://api.semanticscholar.org/v1/paper/${o}?include_unknown_references=true`,{method:"GET"});if(1==t.ok){var r=await t.json(),{citations:i,references:n}=r;let e={doi:o,data:r,citations:i||[],references:n||[]};e.citations=e.citations.filter(e=>e.doi||e.url).map(e=>zoteroRoam.utils.parseSemanticItem(e)),e.references=e.references.filter(e=>e.doi||e.url).map(e=>zoteroRoam.utils.parseSemanticItem(e)),a={success:!0,data:e}}else console.log(`The request for ${t.url} returned a code of ${t.status}`),a={doi:o,success:!1,response:t}}catch(e){a={doi:o,success:null,error:e}}finally{return a}},async requestData(o,a=!1,r=!0){let i=[],n=[],s=[],l=[],c=[];if(0==o.length)throw new Error("No data requests were added to the config object - check for upstream problems");try{o.forEach(e=>{i.push(zoteroRoam.handlers.fetchData(apiKey=e.apikey,dataURI=e.dataURI,params=e.params))});let e=await Promise.all(i);e=e.map((e,t)=>e.data.map(e=>(e.requestLabel=o[t].name,e.requestIndex=t,e))).flat(1),e=zoteroRoam.handlers.extractCitekeys(e);let t=zoteroRoam.data.libraries;return 1==r&&(t.forEach(e=>{n.push(fetch(`https://api.zotero.org/${e.path}/collections?since=${e.version}&limit=100`,{method:"GET",headers:{"Zotero-API-Version":3,"Zotero-API-Key":e.apikey}}))}),s=await Promise.all(n),s=await Promise.all(s.map((e,t)=>{var o=e.headers.get("Last-Modified-Version");return o&&(zoteroRoam.data.libraries[t].version=o),e.json()})),s=s.flat(1)),1==a&&(t.forEach(e=>{l.push(fetch(`https://api.zotero.org/${e.path}/deleted?since=${e.version}`,{method:"GET",headers:{"Zotero-API-Version":3,"Zotero-API-Key":e.apikey}}))}),c=await Promise.all(l),c=await Promise.all(c.map(e=>e.json())),c=c.map((e,t)=>({path:zoteroRoam.data.libraries[t].path,items:e.items,collections:e.collections})),zoteroRoam.data.items=zoteroRoam.data.items.filter(t=>!c.find(e=>e.path==zoteroRoam.utils.getItemPrefix(t)).items.includes(t.data.key)),zoteroRoam.data.collections=zoteroRoam.data.collections.filter(t=>!c.find(e=>e.path==zoteroRoam.utils.getItemPrefix(t)).collections.includes(t.key))),{success:!0,data:{items:e,collections:s,deleted:c}}}catch(e){return console.error(e),console.log({dataCalls:i,collectionsCalls:n,deletedCalls:l}),{success:!1,data:null}}},async requestItemBib(e,{include:t="bib",style:o,linkwrap:a,locale:r}={}){var i="user"==e.library.type?"users":"groups",n=zoteroRoam.config.requests[`${e.requestIndex}`].apikey;let s=await fetch(`https://api.zotero.org/${i}/${e.library.id}/items/${e.data.key}?include=${t}&style=${o}&linkwrap=${a}&locale=${r}`,{method:"GET",headers:{"Zotero-API-Version":3,"Zotero-API-Key":n}});return(await s.json())[`${t}`]},async requestItemChildren(e){var t=zoteroRoam.config.requests[`${e.requestIndex}`].apikey;let o=await fetch(`${e.links.self.href}/children`,{method:"GET",headers:{"Zotero-API-Version":3,"Zotero-API-Key":t}});return await o.json()},simplifyDataArray(e){let t=e.filter(e=>!["attachment","note","annotation"].includes(e.data.itemType));return t=t.map(e=>{let t={key:e.key,itemKey:e.data.key,title:`${e.data.title||""}`,abstract:`${e.data.abstractNote||""}`,authors:`${e.meta.creatorSummary||""}`,year:`${e.meta.parsedDate?new Date(e.meta.parsedDate).getUTCFullYear().toString():""}`,meta:`${zoteroRoam.utils.makeMetaString(e)}`,tags:e.data.tags.map(e=>e.tag),authorsFull:e.data.creators.map(e=>e.name||[e.firstName,e.lastName].filter(Boolean).join(" ")),authorsRoles:e.data.creators.map(e=>e.creatorType),authorsLastNames:e.data.creators.map(e=>e.lastName||e.name),authorsString:e.data.creators.map(e=>e.lastName||e.name).join(" "),tagsString:e.data.tags.map(e=>`#${e.tag}`).join(", "),location:zoteroRoam.utils.getItemPrefix(e)};return t._multiField=t.authorsString+" "+t.year+" "+t.title+" "+t.tagsString,t}),t},simplifyCitationsObject(e){return 0<e.length?e.map(e=>{let t={abstract:e.abstract||"",doi:e.doi||"",keywords:e.keywords||[],keywordsString:e.keywords?e.keywords.join(" "):"",links:{scite:`https://scite.ai/reports/${e.slug}`},title:e.title,year:`${e.year}`||"",meta:""},o=0<e.authors.length?e.authors.map(e=>e.family):[];return t.authorsLastNames=0<e.authors.length?e.authors.map(e=>e.family):[],t.authorsString=t.authorsLastNames.join(" "),o=0<o.length?2<o.length?o.slice(0,1).join(", ")+" et al.":o.map((e,t)=>0==t?e:t<o.length-1?`, ${e}`:` and ${e}`).join(""):"",t.authors=o,t.meta=`${e.journal||e.publisher}${e.volume?", "+e.volume+"("+e.issue+")":""}${e.page?", "+e.page+".":"."}`,e.inLibrary&&(t.inLibrary=!0),t.links.connectedPapers=`https://www.connectedpapers.com/${e.doi?"api/redirect/doi/"+e.doi:"search?q="+encodeURIComponent(e.title)}`,e.doi&&(t.links.semanticScholar=`https://api.semanticscholar.org/${e.doi}`),t.links.googleScholar=`https://scholar.google.com/scholar?q=${e.doi||encodeURIComponent(e.title)}`,t}):[]},getCitationsKeywordsCounts(o){if(0<o.length){let e=o.map(e=>e.keywords?e.keywords.map(e=>e.toLowerCase()):[]).flat(1),t=[];for(var a=0;a<e.length;a++){var r=e[a];t.push({keyword:r,count:e.filter(e=>e==r).length}),e=e.filter(e=>e!=r)}return t.sort((e,t)=>e.count<t.count?1:-1)}return[]},getLibItems(t="citekey",o="citekey"){return zoteroRoam.data.items.filter(e=>!["attachment","note","annotation"].includes(e.data.itemType)).map(e=>({key:e.key,source:"zotero",value:zoteroRoam.utils.formatItemReference(e,t)||e.key,display:zoteroRoam.utils.formatItemReference(e,o)}))},async waitForBlockUID(e,t){let o=null,a=!1,r=0;try{do{if(o=zoteroRoam.utils.getTopBlockData(e),void 0!==o.text&&o.text==t)return a=!0,o.uid}while(r+=1,await zoteroRoam.utils.sleep(75),r<50&&!a);throw console.log(o),new Error("The top block couldn't be matched")}catch(e){console.error(e)}},async waitForPageUID(e){let t=!1,o=0;do{var a=zoteroRoam.utils.lookForPage(e);if(1==a.present)return t=!0,a.uid}while(o+=1,await zoteroRoam.utils.sleep(75),o<50&&!t);throw new Error(`The page with title "${e}" couldn\'t be found`)}},zoteroRoam.write={async patchItemData(t,e){let o=zoteroRoam.config.requests.find(e=>e.name==t.requestLabel);var a=o.dataURI.match(/(users|groups)\/(.+?)\//g)[0].slice(0,-1);let r=await fetch(`https://api.zotero.org/${a}/items/${t.data.key}`,{method:"PATCH",body:JSON.stringify(e),headers:{"Zotero-API-Version":3,"Zotero-API-Key":o.apikey,"If-Unmodified-Since-Version":t.version}});if(204!=r.status)return{success:!1,response:r};e=r.headers.get("Last-Modified-Version");return{success:!0,version:zoteroRoam.data.items.find(e=>e.key==t.key).version=e}},async editItemTags(e,{add:t=[],remove:o=[]}={}){let a=e.data.tags.map(e=>e.tag);t=a.filter(e=>!o.includes(e)).push(...t).map(e=>({tag:e}));return await zoteroRoam.write.patchItemData(e,{tags:t})},async toggleTags(a,r=[]){let i=a.data.tags.map(e=>e.tag);if(1<r.length){let o=-1;r.forEach((e,t)=>{-1==o&&(o=i.includes(e)?t:-1)});let e={};if(e=-1==o?await zoteroRoam.write.editItemTags(a,{add:[r[0]]}):o==r.length-1?await zoteroRoam.write.editItemTags(a,{add:[r[0]],remove:r.slice(1)}):await zoteroRoam.write.editItemTags(a,{add:[r[o]],remove:r.filter(t!=r[o])}),1==e.success)return r[o]}},async importItems(t,o,a=!0){t=t.constructor===Array?t:[t];let r={};try{var i,n,s=zoteroRoam.data.libraries.findIndex(e=>e.path==o.path);let e=await fetch(`https://api.zotero.org/${o.path}/items`,{method:"POST",body:JSON.stringify(t),headers:{"Zotero-API-Version":3,"Zotero-API-Key":o.apikey,"If-Unmodified-Since-Version":o.version}});r=1==e.ok?(i=await e.json(),(n=e.headers.get("Last-Modified-Version"))&&(zoteroRoam.data.libraries[s].version=n),zoteroRoam.activeImport.libraries=zoteroRoam.utils.getLibraries(),zoteroRoam.activeImport.currentLib=zoteroRoam.activeImport.libraries.find(e=>e.path==zoteroRoam.activeImport.currentLib.path),{success:!0,data:i}):412==e.status&&1==a?(await zoteroRoam.extension.update(popup=!1,reqs=zoteroRoam.config.requests.filter(e=>e.library==o.path)),zoteroRoam.activeImport.libraries=zoteroRoam.utils.getLibraries(),zoteroRoam.activeImport.currentLib=zoteroRoam.activeImport.libraries.find(e=>e.path==zoteroRoam.activeImport.currentLib.path),await zoteroRoam.write.importItems(t,o=zoteroRoam.activeImport.currentLib,a=!1)):(console.log(`The request for ${e.url} returned a code of ${e.status} (${e.statusText}).`),{success:!1,response:e})}catch(e){r={success:null,error:e}}finally{return r}},async checkImport(e){var t=zoteroRoam.activeImport.currentLib;let o=Object.values(e).map(e=>e.data.key);var a,r=Object.values(e)[0].version;let i=r,n=!1;try{let e=await fetch(`https://api.zotero.org/${t.path}/items?itemKey=${o.join(",")}&since=${r}`,{method:"GET",headers:{"Zotero-API-Version":3,"Zotero-API-Key":t.apikey}});!e.ok||0<(a=await e.json()).length&&(n={...zoteroRoam.handlers.extractCitekeys(a)},i=e.headers.get("Last-Modified-Version"))}catch(e){console.log(e)}return{updated:i>r,data:n||e}}},zoteroRoam.interface={icon:null,portal:{div:null,id:"zotero-roam-portal"},contextTarget:null,contextMenu:{div:null,class:"zotero-roam-context-menu",overlay:{div:null,class:"zotero-roam-context-overlay"},options:{list:[],class:"zotero-roam-context-menu-option",labels:["Import Zotero data to page","Convert to citation","Check for citing papers","View item information"]},visible:!1,position({top:e,left:t}){zoteroRoam.interface.contextMenu.div.style.left=`${t}px`,zoteroRoam.interface.contextMenu.div.style.top=`${e}px`,zoteroRoam.interface.toggleContextOverlay("contextMenu","show")}},iconContextMenu:{div:null,class:"zotero-roam-icon-context-menu",overlay:{div:null,class:"zotero-roam-icon-context-overlay"},options:{list:[],class:"zotero-roam-icon-context-menu-option",labels:["Update Zotero data","Search in dataset..."]},visible:!1,position({top:e,left:t}){zoteroRoam.interface.iconContextMenu.div.style.left=t>=.9*window.innerWidth?`calc(${t}px - 10%)`:`${t}px`,zoteroRoam.interface.iconContextMenu.div.style.top=`calc(${e}px + 3%)`,zoteroRoam.interface.toggleContextOverlay("iconContextMenu","show")}},citations:{overlay:null,input:null,closeButton:null,overlayClass:"zotero-roam-citations-search"},search:{overlay:null,input:null,selectedItemDiv:null,closeButton:null,updateButton:null,overlayClass:"zotero-roam-search"},tributeTrigger:"",tributeBlockTrigger:null,tributeNewText:"",create(){zoteroRoam.interface.createIcon(id="zotero-roam-icon"),zoteroRoam.interface.portal.div=zoteroRoam.interface.createPortal(id=zoteroRoam.interface.portal.id),zoteroRoam.interface.createContextMenu(elementKey="contextMenu"),zoteroRoam.interface.createContextMenu(elementKey="iconContextMenu"),zoteroRoam.interface.createOverlay(divClass=zoteroRoam.interface.search.overlayClass),zoteroRoam.interface.fillSearchOverlay(),zoteroRoam.interface.createOverlay(divClass=zoteroRoam.interface.citations.overlayClass),zoteroRoam.interface.fillCitationsOverlay(),zoteroRoam.interface.createOverlay(divClass="zotero-roam-auxiliary",dialogCSS="align-self:start;transition:0.5s;",useBackdrop=!0,commonTag="zotero-roam-dialog-small"),zoteroRoam.interface.fillAuxiliaryOverlay(),zoteroRoam.interface.createToastOverlay()},setup(){zoteroRoam.interface.icon.addEventListener("click",zoteroRoam.extension.toggle),zoteroRoam.interface.setupContextMenus(["contextMenu","iconContextMenu"]),zoteroRoam.interface.search.updateButton.addEventListener("click",function(){zoteroRoam.extension.update(popup=!0)}),document.addEventListener("click",t=>{if(t.target.closest(".zotero-roam-page-div")||t.target.closest(".zotero-roam-page-related")||t.target.closest(".zotero-roam-explo-import"))zoteroRoam.inPage.handleClicks(t.target);else if(t.target.closest(".zotero-roam-search-close")){let e=t.target.closest(".zotero-roam-dialog-overlay")||t.target.closest(".zotero-roam-dialog-small");e.classList.contains("zotero-roam-citations-search-overlay")?zoteroRoam.interface.closeCitationsOverlay():e.classList.contains("zotero-roam-search-overlay")?zoteroRoam.interface.toggleSearchOverlay("hide"):e.classList.contains("zotero-roam-auxiliary-overlay")&&zoteroRoam.interface.closeAuxiliaryOverlay()}else t.target.closest("[zr-import]")&&zoteroRoam.interface.handleImportPanelClicks(t)})},createIcon(e){try{document.getElementById(e).closest(".bp3-popover-wrapper").remove()}catch(e){}var t=document.createElement("span");t.classList.add("bp3-popover-wrapper"),t.setAttribute("style","margin-left: 4px;"),t.innerHTML=`<span class="bp3-popover-target"><span id="${e}" status="off" class="bp3-button bp3-icon-manual bp3-minimal bp3-small"></span>`,document.querySelector(".rm-topbar").appendChild(t),zoteroRoam.interface.icon=document.getElementById(e)},createPortal(e){try{document.getElementById(e).remove()}catch(e){}var t=document.createElement("div");return t.classList.add("bp3-portal"),t.id=e,document.getElementById("app").appendChild(t),t},createContextMenu(e){let t=zoteroRoam.interface[`${e}`];try{document.querySelector(`.${t.overlay.class}`).remove()}catch(e){}var o=t.options.labels.map(e=>`<li class="${t.options.class} zotero-roam-cm-option"><a class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-fill bp3-text-overflow-ellipsis">${e}</div></a></li>`).join(""),a=document.createElement("div");a.classList.add("bp3-overlay"),a.classList.add("bp3-overlay-open"),a.classList.add(`${t.overlay.class}`),a.style="display:none;",a.innerHTML=`
            <div class="bp3-overlay-backdrop bp3-popover-backdrop bp3-popover-appear-done bp3-popover-enter-done" style="z-index:25;"></div>
            <div class="bp3-transition-container bp3-popover-appear-done bp3-popover-enter-done ${t.class}" style="width: auto; position: fixed;z-index:25;">
                <div class="bp3-popover bp3-minimal ${zoteroRoam.config.params.theme||""}">
                    <div class="bp3-popover-content">
                        <div>
                            <ul class="bp3-menu bp3-text-small">
                                ${o}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>`,zoteroRoam.interface.portal.div.appendChild(a),zoteroRoam.interface[`${e}`].overlay.div=document.querySelector(`.${zoteroRoam.interface[`${e}`].overlay.class}`),zoteroRoam.interface[`${e}`].div=document.querySelector(`.${zoteroRoam.interface[`${e}`].class}`),zoteroRoam.interface[`${e}`].options.list=document.querySelectorAll(`.${zoteroRoam.interface[`${e}`].options.class}`)},createToastOverlay(){let e=document.createElement("div");e.classList.add("bp3-overlay"),e.classList.add("bp3-overlay-open"),e.classList.add("bp3-toast-container"),e.classList.add("bp3-toast-container-top"),e.classList.add("bp3-toast-container-in-portal"),e.classList.add("zotero-roam-toast-overlay"),zoteroRoam.interface.portal.div.appendChild(e)},async popToast(e,t="primary"){let o=zoteroRoam.interface.portal.div.querySelector(".zotero-roam-toast-overlay");o.innerHTML=zoteroRoam.utils.renderBP3Toast(string=e,{toastClass:`bp3-intent-${t}`}),o.querySelector(".bp3-toast").style.opacity="1",await zoteroRoam.utils.sleep(700),o.querySelector(".bp3-toast").style.top="-100px"},createOverlay(t,e="align-self:baseline;transition:0.5s;",o=!0,a="zotero-roam-dialog-overlay"){try{document.querySelector(`.${t}-overlay`).remove()}catch(e){}let r=document.createElement("div");if(r.classList.add("bp3-overlay"),r.classList.add("bp3-overlay-open"),r.classList.add("bp3-overlay-scroll-container"),r.classList.add(`${t}-overlay`),a&&r.classList.add(a),r.setAttribute("overlay-visible","false"),r.style="display:none;",o){let e=document.createElement("div");e.classList.add("bp3-overlay-backdrop"),e.classList.add("bp3-overlay-appear-done"),e.classList.add("bp3-overlay-enter-done"),e.classList.add(`${t}-backdrop`),e.tabIndex="0",r.appendChild(e)}let i=document.createElement("div");i.classList.add("bp3-dialog-container"),i.classList.add("bp3-overlay-content"),i.classList.add("bp3-overlay-appear-done"),i.classList.add("bp3-overlay-enter-done"),i.tabIndex="0";let n=document.createElement("div");n.classList.add("bp3-dialog"),zoteroRoam.config.params.theme&&n.classList.add(zoteroRoam.config.params.theme),n.setAttribute("side-panel","hidden"),n.style=e;let s=document.createElement("div");s.classList.add("bp3-dialog-body");let l=document.createElement("div");l.classList.add("main-panel"),l.style="flex: 1 1 100%;";let c=document.createElement("div");c.classList.add("side-panel"),c.style="flex: 1 0 0%;";let m=document.createElement("div");m.classList.add("side-panel-contents"),c.appendChild(m),s.appendChild(l),s.appendChild(c),n.appendChild(s),i.appendChild(n),r.appendChild(i),zoteroRoam.interface.portal.div.appendChild(r)},fillAuxiliaryOverlay(){let e=document.querySelector(".zotero-roam-auxiliary-overlay .bp3-dialog-body .main-panel"),t=document.querySelector(".zotero-roam-auxiliary-overlay .bp3-dialog-body .side-panel-contents"),o=document.createElement("div");o.classList.add("bp3-card");let a=document.createElement("div");a.classList.add("bp3-input-group"),a.classList.add("header-content");let r=document.createElement("div");r.classList.add("header-left");let i=document.createElement("div");i.classList.add("header-right");let n=document.createElement("div");n.classList.add("controls-top"),n.innerHTML=`
            <button type="button" aria-label="Close" class="zotero-roam-search-close bp3-button bp3-minimal bp3-dialog-close-button">
            <span icon="small-cross" class="bp3-icon bp3-icon-small-cross"></span></button>
            `,i.appendChild(n),a.appendChild(r),a.appendChild(i);let s=document.createElement("div");s.classList.add("rendered-div"),s.style="width:95%;margin:0 auto;",o.appendChild(a),o.appendChild(s),e.appendChild(o);let l=document.createElement("div");l.classList.add("import-header"),l.innerHTML=`
            ${zoteroRoam.utils.renderBP3Button_group("Add to Zotero",{buttonClass:"bp3-minimal bp3-intent-primary",icon:"inheritance",buttonAttribute:'disabled role="add" style="font-weight:600;"'})}
            `;let c=document.createElement("div");c.classList.add("import-options");let m=document.createElement("div");m.classList.add("options-library-list");let d=document.createElement("div");d.classList.add("options-collections-list"),c.appendChild(m),c.appendChild(d),t.setAttribute("zr-import","weblinks"),t.appendChild(l),t.appendChild(c),e.addEventListener("click",function(e){let o=e.target.closest("button");if(o)if(o.classList.contains("zotero-roam-citation-toggle-abstract")){let e=o.querySelector(".bp3-button-text"),t=o.closest(".zotero-roam-list-item").querySelector(".zotero-roam-citation-abstract");"none"==t.style.display?(t.style.display="block",e.innerHTML="Hide Abstract"):(t.style.display="none",e.innerHTML="Show Abstract")}else{var t;o.classList.contains("zotero-roam-add-to-graph")&&(t=o.closest(".bp3-menu-item").getAttribute("label"),console.log("Importing metadata..."),zoteroRoam.handlers.importItemMetadata(title="@"+t,uid="",{popup:!0}))}else{let t=e.target.closest('input[type="checkbox"]');if(t&&"selectAll"==t.getAttribute("name")){var a=t.checked;let e=Array.from(document.querySelectorAll('.zotero-roam-auxiliary-overlay [name="explo-weblink"]'));e.forEach(e=>{e.checked=a}),zoteroRoam.interface.triggerImport(type="weblinks")}else t&&"explo-weblink"==t.getAttribute("name")&&zoteroRoam.interface.triggerImport(type="weblinks")}})},fillSearchOverlay(e=zoteroRoam.interface.search.overlayClass){let t=document.querySelector(`.${e}-overlay .bp3-dialog-body .main-panel`),o=document.createElement("div");o.classList.add("bp3-input-group"),o.classList.add("header-content");let a=document.createElement("div");a.classList.add("header-left");let r=document.createElement("h5");r.classList.add("panel-tt"),r.setAttribute("list-type","library"),r.innerText="Zotero Library";let i=document.createElement("p");i.classList.add("bp3-text-muted"),i.classList.add("bp3-text-small"),i.classList.add("panel-st"),i.innerText="Search by title, year, authors (last names), citekey, tags";let n=document.createElement("input");n.id="zotero-roam-search-autocomplete",n.tabIndex="1",n.type="text",n.classList.add("bp3-input"),a.appendChild(r),a.appendChild(i),a.appendChild(n);let s=document.createElement("div");s.classList.add("header-right");let l=document.createElement("div");l.classList.add("controls-top"),l.innerHTML=`
            <button type="button" aria-label="Close" class="zotero-roam-search-close bp3-button bp3-minimal bp3-dialog-close-button">
            <span icon="small-cross" class="bp3-icon bp3-icon-small-cross"></span></button>
            `;let c=document.createElement("label");c.classList.add("bp3-control"),c.classList.add("bp3-switch"),c.classList.add("bp3-text-small"),c.classList.add("quick-copy-element");let m=document.createElement("input");m.id="zotero-roam-quick-copy-mode",m.setAttribute("type","checkbox"),c.appendChild(m);let d=document.createElement("span");d.classList.add("bp3-control-indicator"),c.appendChild(d),c.innerHTML+="Quick Copy",s.appendChild(l),s.appendChild(c),o.appendChild(a),o.appendChild(s),t.appendChild(o);let p=document.createElement("div");p.id="zotero-roam-library-rendered",p.setAttribute("view","search");let u=document.createElement("div");u.id="zotero-roam-library-search-div";let g=document.createElement("div");g.classList.add("bp3-button-group"),g.classList.add("bp3-minimal"),g.innerHTML=`
            <span class="zotero-roam-library-results-count"></span>
            `,u.appendChild(g);let b=document.createElement("div");b.id="zotero-roam-search-selected-item",b.classList.add("bp3-card");let y=document.createElement("div");y.classList.add("selected-item-header");let h=document.createElement("div");h.classList.add("selected-item-body"),b.appendChild(y),b.appendChild(h),p.appendChild(u),p.appendChild(b),t.appendChild(p);let f=document.createElement("div");f.classList.add("bp3-dialog-footer-actions"),f.innerHTML=`
            <input class="bp3-input clipboard-copy-utility" type="text" readonly style="opacity:0;">
            <span class="bp3-popover2-target" tabindex="0">
                <button type="button" class="zotero-roam-update-data bp3-button bp3-minimal">
                <span icon="refresh" class="bp3-icon bp3-icon-refresh"></span>
                <span class="bp3-button-text">Update Zotero data</span>
                </button>
            </span>
            `,t.appendChild(f),zoteroRoam.interface.search.overlay=document.querySelector(`.${e}-overlay`),zoteroRoam.interface.search.input=document.querySelector("#zotero-roam-search-autocomplete"),zoteroRoam.interface.search.selectedItemDiv=document.querySelector("#zotero-roam-search-selected-item"),zoteroRoam.interface.search.closeButton=document.querySelector(`.${e}-overlay button.zotero-roam-search-close`),zoteroRoam.interface.search.updateButton=document.querySelector(`.${e}-overlay button.zotero-roam-update-data`)},fillCitationsOverlay(e=zoteroRoam.interface.citations.overlayClass){let t=document.querySelector(`.${e}-overlay .bp3-dialog-body .main-panel`),o=document.querySelector(`.${e}-overlay .bp3-dialog-body .side-panel-contents`),a=document.createElement("div");a.classList.add("bp3-input-group"),a.classList.add("header-content");let r=document.createElement("div");r.classList.add("header-left");let i=document.createElement("h5");i.classList.add("panel-tt"),i.innerText="Citing Papers";let n=document.createElement("p");n.classList.add("bp3-text-muted"),n.classList.add("bp3-text-small"),n.classList.add("panel-st"),n.innerText="Search by title, year, authors (last names), publication";let s=document.createElement("input");s.id="zotero-roam-citations-autocomplete",s.tabIndex="1",s.type="text",s.classList.add("bp3-input"),r.appendChild(i),r.appendChild(n),r.appendChild(s);let l=document.createElement("div");l.classList.add("header-right");let c=document.createElement("div");c.classList.add("controls-top"),c.innerHTML=`
            <button type="button" aria-label="Close" class="zotero-roam-search-close bp3-button bp3-minimal bp3-dialog-close-button">
            <span icon="small-cross" class="bp3-icon bp3-icon-small-cross"></span></button>
            `,l.appendChild(c),a.appendChild(r),a.appendChild(l);let m=document.createElement("div");m.id="zotero-roam-citations-pagination";let d=document.createElement("div");d.classList.add("bp3-button-group"),d.classList.add("bp3-minimal"),d.innerHTML=`
            ${zoteroRoam.utils.renderBP3Button_group(string="",{icon:"chevron-left",buttonClass:"zotero-roam-page-control",buttonAttribute:'goto="previous"'})}
            ${zoteroRoam.utils.renderBP3Button_group(string="",{icon:"chevron-right",buttonClass:"zotero-roam-page-control",buttonAttribute:'goto="next"'})}
            <span class="zotero-roam-citations-results-count"></span>
            `,m.appendChild(d),t.appendChild(a),t.appendChild(m);let p=document.createElement("div");p.classList.add("import-header"),p.innerHTML=`
            ${zoteroRoam.utils.renderBP3Button_group("Cancel",{buttonClass:"bp3-minimal bp3-intent-warning",icon:"chevron-left",buttonAttribute:'role="cancel"'})}
            ${zoteroRoam.utils.renderBP3Button_group("Add to Zotero",{buttonClass:"bp3-minimal bp3-intent-primary",icon:"inheritance",buttonAttribute:'disabled role="add" style="font-weight:600;"'})}
            `;let u=document.createElement("div");u.classList.add("import-options");let g=document.createElement("div");g.classList.add("options-library-list");let b=document.createElement("div");b.classList.add("options-collections-list");let y=document.createElement("div");y.classList.add("options-tags");let h=document.createElement("div");h.classList.add("options-tags-select"),h.classList.add("bp3-input-group"),h.classList.add("bp3-small");let f=document.createElement("span");f.classList.add("bp3-icon"),f.classList.add("bp3-icon-tag"),f.classList.add("bp3-intent-primary");let z=document.createElement("input");z.id="zotero-roam-tags-autocomplete",z.tabIndex="1",z.type="text",z.classList.add("bp3-input"),z.classList.add("bp3-fill"),z.setAttribute("autocomplete","off");let v=document.createElement("div");v.classList.add("options-tags_selection"),v.setAttribute("data-tags","[]"),h.appendChild(f),h.appendChild(z),y.appendChild(h),y.appendChild(v),u.appendChild(g),u.appendChild(b),u.appendChild(y);let k=document.createElement("h5");k.innerText="Selected Items",k.classList.add("import-selection-header");let R=document.createElement("div");R.classList.add("import-items"),R.classList.add("bp3-list-unstyled"),o.setAttribute("zr-import","citations"),o.appendChild(p),o.appendChild(u),o.appendChild(k),o.appendChild(R);let w=document.createElement("div");w.classList.add("bp3-dialog-footer-actions"),w.innerHTML=`
            <input class="bp3-input clipboard-copy-utility" type="text" readonly style="opacity:0;">
            `,t.appendChild(w),zoteroRoam.interface.citations.overlay=document.querySelector(`.${e}-overlay`),zoteroRoam.interface.citations.input=document.querySelector("#zotero-roam-citations-autocomplete"),zoteroRoam.interface.citations.closeButton=document.querySelector(`.${e}-overlay button.zotero-roam-search-close`),Array.from(zoteroRoam.interface.citations.overlay.querySelectorAll(".zotero-roam-page-control")).forEach(t=>{t.addEventListener("click",e=>{zoteroRoam.interface.changePage(goto=t.getAttribute("goto"))})}),m.addEventListener("click",function(e){let o=e.target.closest("button");if(o)if(o.classList.contains("zotero-roam-citation-copy-doi"))zoteroRoam.interface.citations.overlay.querySelector("input.clipboard-copy-utility").value=o.dataset.doi,zoteroRoam.interface.citations.overlay.querySelector("input.clipboard-copy-utility").select(),document.execCommand("copy");else if(o.classList.contains("zotero-roam-citation-toggle-abstract")){let e=o.querySelector(".bp3-button-text"),t=o.closest(".zotero-roam-citations-search_result").querySelector(".zotero-roam-citation-abstract");"none"==t.style.display?(t.style.display="block",e.innerHTML="Hide Abstract"):(t.style.display="none",e.innerHTML="Show Abstract")}else o.classList.contains("zotero-roam-citation-add-import")&&zoteroRoam.interface.triggerImport(type="citations",element=o.closest(".bp3-menu-item"))})},async handleImportPanelClicks(o){let a=o.target.closest("[zr-import]"),r=a.getAttribute("zr-import"),e=o.target.closest("button[role]");if(null!==e)switch(e.getAttribute("role")){case"cancel":zoteroRoam.interface.clearImportPanel(action="close",r);break;case"add":var t;e.setAttribute("disabled",""),"citations"==r&&(t=await zoteroRoam.handlers.importSelectedItems(),zoteroRoam.citations.activeImport.outcome=t,zoteroRoam.interface.renderImportResults(t));break;case"done":zoteroRoam.interface.clearImportPanel(action="reset",r)}if(null!==o.target.closest('input[name="library"]')&&zoteroRoam.interface.selectImportLibrary(r),null!==o.target.closest(".options-tags_selection")){let e=o.target.closest(".bp3-tag-remove");if(null!==e){let t=e.closest(".bp3-tag");try{if("citations"==r){let e=a.querySelector(".options-tags_selection");e.dataset.tags=JSON.stringify(JSON.parse(e.dataset.tags).filter(e=>e!=t.dataset.tag)),t.remove()}}catch(o){console.error(o)}}}if(null!==o.target.closest(".import-items")){let e=o.target.closest("button.selected_remove-button");if(null!==e){let t=e.closest(".import-items_selected");try{"citations"==r&&(zoteroRoam.citations.activeImport.items=zoteroRoam.citations.activeImport.items.filter(e=>e!=t.dataset.identifier),t.remove(),zoteroRoam.interface.citations.overlay.querySelector(".import-selection-header").innerText=`Selected Items (${zoteroRoam.citations.activeImport.items.length})`,0==zoteroRoam.citations.activeImport.items.length&&(zoteroRoam.interface.citations.overlay.querySelector('button[role="add"]').setAttribute("disabled",""),zoteroRoam.interface.citations.overlay.querySelector(".import-selection-header").innerText="Selected Items"))}catch(o){console.error(o)}}}},renderCitationsPagination(){let e=document.querySelector("#zotero-roam-citations-pagination"),t=e.querySelector("ul");null==t&&(t=document.createElement("ul"),t.classList.add("zotero-roam-citations-search-results-list"),t.classList.add("bp3-menu"),t.tabIndex="-1",t.setAttribute("role","listbox"),e.appendChild(t));let o=zoteroRoam.citations.pagination.getCurrentPageData();e.querySelector(".zotero-roam-citations-results-count").innerHTML=`
            <strong>${zoteroRoam.citations.pagination.startIndex}-${zoteroRoam.citations.pagination.startIndex+o.length-1}</strong> / ${zoteroRoam.citations.pagination.data.length} ${zoteroRoam.citations.currentType}
            `,t.innerHTML=o.map(t=>{var o,e=`<span class="zotero-roam-search-item-title" style="display:block;">${t.title} ${t.inLibrary?'<span icon="endorsed" class="bp3-icon bp3-icon-endorsed bp3-intent-success"></span>':""}</span>`,a=t.authors+(t.year?" ("+t.year+")":""),r=`<span class="zotero-roam-citation-metadata-contents">${zoteroRoam.utils.renderBP3Tag(a,{modifier:"bp3-intent-warning zotero-roam-citation-origin"})} ${t.meta}</span>`;let i="";for(o of Object.keys(t.links)){let e=[];switch(o){case"scite":e.push(`<span class="zotero-roam-citation-link" service="scite"><a href="${t.links[o]}" target="_blank">Scite</a></span>`);break;case"connectedPapers":e.push(`<span class="zotero-roam-citation-link" service="connected-papers"><a href="${t.links[o]}" target="_blank">Connected Papers</a></span>`);break;case"semanticScholar":e.push(`<span class="zotero-roam-citation-link" service="semantic-scholar"><a href="${t.links[o]}" target="_blank">Semantic Scholar</a></span>`);break;case"googleScholar":e.push(`<span class="zotero-roam-citation-link" service="google-scholar"><a href="${t.links[o]}" target="_blank">Google Scholar</a></span>`)}i+=e.join(" &#8226; ")}a=`
                <span class="bp3-menu-item-label zotero-roam-search-item-key">
                <a href="${t.doi?"https://doi.org/"+t.doi:t.url}" target="_blank" class="bp3-text-muted zotero-roam-citation-identifier-link">${t.doi||t.url}</a>
                ${t.abstract?zoteroRoam.utils.renderBP3Button_group("Show Abstract",{buttonClass:"zotero-roam-citation-toggle-abstract bp3-minimal"}):""}
                ${t.doi?zoteroRoam.utils.renderBP3Button_group("Copy DOI",{buttonClass:"zotero-roam-citation-copy-doi bp3-small bp3-outlined",buttonAttribute:'data-doi="'+t.doi+'"'}):""}
                ${t.inLibrary?"":zoteroRoam.utils.renderBP3Button_group("Add to Zotero",{buttonClass:"zotero-roam-citation-add-import bp3-small bp3-outlined bp3-intent-primary",icon:"inheritance"})}
                </span>
                `;return`
                <li class="zotero-roam-citations-search_result" ${t.inLibrary?'in-library="true"':""}>
                <div class="bp3-menu-item">
                <div class="bp3-text-overflow-ellipsis bp3-fill zotero-roam-citation-metadata">
                ${e}
                ${r}
                <span class="zotero-roam-citation-links-list">
                ${i}
                </span>
                </div>
                ${a}
                <span class="zotero-roam-citation-abstract" style="display:none;">${t.abstract}</span>
                </div></li>
                `}).join("")},setupContextMenus(t){window.addEventListener("click",e=>{t.forEach(e=>{zoteroRoam.interface[`${e}`].visible&&zoteroRoam.interface.toggleContextOverlay(e,command="hide")})}),t.forEach(e=>{zoteroRoam.interface[`${e}`].div.addEventListener("click",e=>{var t=zoteroRoam.interface.contextTarget,e=e.target.closest("li.zotero-roam-cm-option");if(e)switch(e.innerText){case"Import Zotero data to page":var o=t.parentElement.dataset.linkTitle,a=t.parentElement.dataset.linkUid;zoteroRoam.handlers.importItemMetadata(title=o,uid=a);break;case"Convert to citation":zoteroRoam.inPage.convertToCitekey(t);break;case"Check for citing papers":zoteroRoam.handlers.checkForSemantic_citations(t);break;case"View item information":zoteroRoam.interface.popItemInformation(t);break;case"Update Zotero data":zoteroRoam.extension.update();break;case"Search in dataset...":zoteroRoam.interface.toggleSearchOverlay("show")}})})},toggleContextOverlay(e,t){zoteroRoam.interface[`${e}`].overlay.div.style.display="show"==t?"block":"none",zoteroRoam.interface[`${e}`].visible="show"==t},async toggleSearchOverlay(e,{focus:t=!0}={}){zoteroRoam.interface.search.overlay.style.display="show"===e?"block":"none","show"==e?(console.log("Opening the Search Panel"),1==t&&(await zoteroRoam.utils.sleep(75),zoteroRoam.interface.search.input.focus()),document.querySelector(".zotero-roam-library-results-count").innerHTML="",zoteroRoam.interface.search.input.value="",zoteroRoam.interface.search.overlay.setAttribute("overlay-visible","true")):(zoteroRoam.interface.clearSelectedItem(),document.querySelector(".zotero-roam-library-results-count").innerHTML="",zoteroRoam.interface.search.input.value="",zoteroRoam.interface.search.overlay.querySelector("input.clipboard-copy-utility").value="",zoteroRoam.interface.search.overlay.setAttribute("overlay-visible","false"))},changePage(e){if(null!==zoteroRoam.citations.pagination&&0<zoteroRoam.citations.pagination.nbPages)switch(e){case"previous":zoteroRoam.citations.pagination.previousPage();break;case"next":zoteroRoam.citations.pagination.nextPage()}},popCitationsOverlay(t,e,o="citations"){zoteroRoam.citations.currentDOI=t,zoteroRoam.citations.currentCitekey=e,zoteroRoam.citations.currentType=o;let a=zoteroRoam.data.semantic.find(e=>e.doi==t)[`${o}`];var r=zoteroRoam.data.items.map(e=>zoteroRoam.utils.parseDOI(e.data.DOI)).filter(Boolean);a.forEach((e,t)=>{e.doi&&zoteroRoam.utils.includes_anycase(r,e.doi)&&(a[t].inLibrary=!0)}),zoteroRoam.citations.pagination=new zoteroRoam.Pagination({data:a}),zoteroRoam.interface.renderCitationsPagination(),null==zoteroRoam.citations.autocomplete?zoteroRoam.citations.autocomplete=new autoComplete(zoteroRoam.config.citationsSearch):zoteroRoam.citations.autocomplete.init();var i="citations"==o?"Citing":"Referenced by";let n=zoteroRoam.interface.citations.overlay.querySelector("h5.panel-tt");n.innerText=`${i} @${e}`,n.setAttribute("list-type",o),zoteroRoam.interface.citations.overlay.style.display="block",zoteroRoam.interface.citations.input.value="",zoteroRoam.interface.citations.overlay.querySelector("input.clipboard-copy-utility").value="",zoteroRoam.interface.citations.overlay.setAttribute("overlay-visible","true"),zoteroRoam.interface.citations.input.focus()},popRelatedDialog(e,t,r){let o=document.querySelector(".zotero-roam-auxiliary-overlay");var a=1<t.length?"s":"",a="added-on"==r?`item${a} added on`:"tagged-with"==r?`item${a} tagged with`:`abstract${a} mentioning`;o.querySelector(".main-panel .header-left").innerHTML=`
            <h5 class="panel-tt" list-type="${r}">${t.length} ${a} ${e}</h5>
            `;let i=zoteroRoam.utils.getAllRefPages();var n="added-on"==r?"timestamp":"meta";let s=t.map(t=>{var e=zoteroRoam.data.items.find(e=>e.key==t),o=e.meta.parsedDate?`(${new Date(e.meta.parsedDate).getUTCFullYear()})`:"",a=e.meta.creatorSummary+" "||"",r=!!i.find(e=>e.title=="@"+t);return{abstract:e.data.abstractNote||"",key:t,meta:`${a}${o}`,title:e.data.title||"",inGraph:r,added:e.data.dateAdded,timestamp:zoteroRoam.utils.makeTimestamp(e.data.dateAdded)}}).sort((e,t)=>e[`${n}`].toLowerCase()<t[`${n}`].toLowerCase()?-1:1);t=s.map(e=>{let t="";var o,a;return t=e.inGraph?(o=zoteroRoam.utils.lookForPage("@"+e.key).uid,a=`${window.location.hash.match(/#\/app\/([^\/]+)/g)[0]}/page/${o}`,zoteroRoam.utils.renderBP3Button_link(string="Go to page",{linkClass:"bp3-minimal bp3-small zotero-roam-list-item-go-to-page",target:a,linkAttribute:`data-uid="${o}"`})):zoteroRoam.utils.renderBP3Button_group("Add to Roam",{icon:"add",buttonClass:"bp3-minimal bp3-intent-success bp3-small zotero-roam-add-to-graph"}),`
                <li class="zotero-roam-list-item">
                <div class="bp3-menu-item" label="${e.key}" in-graph="${e.inGraph}">
                    ${"added-on"==r?`<span class="bp3-menu-item-label zotero-roam-item-timestamp">${e.timestamp}</span>`:""}
                    <div class="bp3-text-overflow-ellipsis bp3-fill zotero-roam-item-contents">
                        <span class="zotero-roam-search-item-title" style="display:block;white-space:normal;">${e.title}</span>
                        <span class="zotero-roam-citation-metadata-contents">${e.meta}</span>
                        <span class="zotero-roam-list-item-key bp3-text-muted">[${e.key}]</span>
                        ${e.abstract?zoteroRoam.utils.renderBP3Button_group("Show Abstract",{buttonClass:"zotero-roam-citation-toggle-abstract bp3-intent-primary bp3-minimal"}):""}
                        <span class="zotero-roam-citation-abstract" style="display:none;">${e.abstract}</span>
                    </div>
                    <span class="zotero-roam-list-item-actions">
                        ${t}
                    </span>
                </div>
                </li>
                `}).join("\n");o.querySelector(".main-panel .rendered-div").innerHTML=`
            <ul class="bp3-list-unstyled">
            ${t}
            </ul>
            `,o.style.display="block",o.setAttribute("overlay-visible","true")},fillWebImportDialog(e){let t=document.querySelector(".zotero-roam-auxiliary-overlay"),o=e.map(e=>({abstract:e.data.abstractNote,creators:e.data.creators?zoteroRoam.formatting.getCreators(e,{creators_as:"string",brackets:!1,use_type:!1}):"",publication:e.data.publicationTitle||e.data.bookTitle||e.data.websiteTitle||"",title:e.data.title||"",type:zoteroRoam.formatting.getItemType(e),url:e.query}));zoteroRoam.webImport.activeImport.harvest=o;e=1<o.length?"s":"";t.querySelector(".main-panel .header-left").innerHTML=`
            ${zoteroRoam.utils.renderBP3_option(string=`<h5 class="panel-tt" list-type="weblinks">${o.length} linked resource${e}</h5>`,type="checkbox",depth=0,{varName:"selectAll"})}
            `;e=o.map((e,t)=>`
                <li class="zotero-roam-list-item zr-explo-list-item">
                    <div class="bp3-menu-item" label="link-${t}">
                        <span class="zr-explo-title">${zoteroRoam.utils.renderBP3_option(string=`<a target="_blank" href="${e.url}">${e.title}</a>`,type="checkbox",depth=0,{varName:"explo-weblink",optValue:`${t}`})}</span>
                        <div class="bp3-text-overflow-ellipsis bp3-fill zotero-roam-item-contents">
                            <span class="zotero-roam-citation-metadata-contents" style="padding-right:10px;">${e.type}${e.creators?" | "+e.creators:""}</span>
                            ${e.publication?`<span class="bp3-text-disabled" style="font-size:0.85em;display:block;white-space:break-spaces;">${e.publication}</span>`:""}
                            <span style="display:block;font-size:0.8em;white-space:break-spaces;" class="bp3-text-muted">${e.abstract}</span>
                        </div>
                    </div>
                </li>
                `).join("\n");t.querySelector(".main-panel .rendered-div").innerHTML=`
            <ul class="bp3-list-unstyled">
            ${e}
            </ul>
            `},closeAuxiliaryOverlay(){let e=document.querySelector(".zotero-roam-auxiliary-overlay");e.style.display="none",e.setAttribute("overlay-visible","false"),e.querySelector(".bp3-dialog").setAttribute("side-panel","hidden")},closeCitationsOverlay(){zoteroRoam.interface.citations.overlay.style.display="none",zoteroRoam.interface.citations.input.value="",zoteroRoam.interface.citations.overlay.querySelector("input.clipboard-copy-utility").value="",zoteroRoam.interface.clearImportPanel(action="close",type="citations"),zoteroRoam.interface.citations.overlay.setAttribute("overlay-visible","false")},popContextOverlay(e,t){e.preventDefault();var o={left:e.pageX,top:e.pageY};return zoteroRoam.interface[`${t}`].position(o),zoteroRoam.interface.contextTarget=e.target,!1},async popContextMenu(e){zoteroRoam.interface.popContextOverlay(e,"contextMenu"),await zoteroRoam.utils.sleep(200);try{document.querySelector("body > .bp3-context-menu+.bp3-portal").style.display="none"}catch(e){}},popIconContextMenu(e){zoteroRoam.interface.popContextOverlay(e,"iconContextMenu")},popItemInformation(e){e=e.parentElement.dataset.linkTitle.replace("@","");zoteroRoam.interface.renderItemInPanel(e)},renderItemInPanel(e){let r=e.startsWith("@")?e:"@"+e,n=zoteroRoam.data.items.find(e=>e.key==r.slice(1));var s=n.meta.parsedDate?` (${new Date(n.meta.parsedDate).getUTCFullYear().toString()})`:"",t=n.data.creators.map(e=>e.name||[e.firstName,e.lastName].filter(Boolean).join(" ")),o=n.data.creators.map(e=>e.creatorType);let a="";if(0<t.length)for(i=0;i<t.length;i++){var l=zoteroRoam.utils.lookForPage(title=t[i]),c=1==l.present?zoteroRoam.utils.renderPageReference(title=t[i],uid=l.uid):zoteroRoam.utils.renderBP3Tag(string=t[i],{modifier:"bp3-intent-primary item-creator-tag"}),l=o[i]&&"author"!=o[i]?` (${o[i]})`:"";a=a+c+l,i<t.length-2?a+=", ":i==t.length-2&&(a+=" & ")}var m=n.data.tags.map(e=>e.tag);let d="";if(0<m.length)for(d="<strong>Tags : </strong>",i=0;i<m.length;i++){var p=1==zoteroRoam.utils.lookForPage(title=m[i]).present?zoteroRoam.utils.renderPageTag(title=m[i]):zoteroRoam.utils.renderBP3Tag(string=m[i]);d=d+p+" "}let u=zoteroRoam.formatting.getItemCollections(n),g="";if(u){g="<strong>Collections : </strong>";try{g+=u.map(e=>zoteroRoam.utils.renderBP3Tag(string=e.data.name,{modifier:"bp3-intent-success bp3-round",icon:"projects"})).join(" ")}catch(e){console.log(u),console.log(e),console.error("Something went wrong while getting the item's collections data")}}var b=zoteroRoam.utils.lookForPage(r),y=1==b.present?"tick":"cross",e=1==b.present?"success":"danger";let h=1==b.present?"In the graph":"Not in the graph";if(1==b.present)try{var f=window.roamAlphaAPI.q("[:find (count ?chld) :in $ ?uid :where[?p :block/uid ?uid][?p :block/children ?chld]]",b.uid)[0][0];h+=` (<b>${f}</b> direct children)`}catch(e){}y=`
            <div class="item-in-graph">
            <span class="bp3-icon-${y} bp3-icon bp3-intent-${e}"></span>
            <span> ${h}</span></div>
            `;let z=document.querySelector(".selected-item-header");z.innerHTML=`
            <div class="item-basic-metadata">
                <h4 class="item-title" tabindex="0">${n.data.title||""}${s}</h4>
                <p class="item-metadata-string">${a}${zoteroRoam.utils.makeMetaString(n)}</p>
                </div>
            <div class="item-citekey-section">
                <div class="bp3-fill citekey-element">${r}</div>
                <div class="bp3-button-group bp3-fill bp3-minimal copy-buttons">
                    <a class="bp3-button bp3-intent-primary" format="citekey">Copy @citekey ${zoteroRoam.shortcuts.sequences.copyCitekey?zoteroRoam.shortcuts.makeSequenceText("copyCitekey"):""}</a>
                    <a class="bp3-button bp3-intent-primary" format="citation">[Citation]([[@]]) ${zoteroRoam.shortcuts.sequences.copyCitation?zoteroRoam.shortcuts.makeSequenceText("copyCitation"):""}</a>
                    <a class="bp3-button bp3-intent-primary" format="tag">#@ ${zoteroRoam.shortcuts.sequences.copyTag?zoteroRoam.shortcuts.makeSequenceText("copyTag"):""}</a>
                    <a class="bp3-button bp3-intent-primary" format="page-reference">[[@]] ${zoteroRoam.shortcuts.sequences.copyPageRef?zoteroRoam.shortcuts.makeSequenceText("copyPageRef"):""}</a>
                </div>
                ${y}
            </div>
            `;let v=document.querySelector(".selected-item-body"),k="";n.data.DOI&&n.data.DOI.startsWith("10.")?(R=`https://doi.org/${n.data.DOI}`,k=zoteroRoam.utils.renderBP3Button_link(string="Open in browser",{linkClass:"bp3-minimal bp3-fill bp3-align-left item-open-in-browser",icon:"share",iconModifier:"bp3-intent-primary",target:R,linkAttribute:'target="_blank"'})):n.data.url&&(k=zoteroRoam.utils.renderBP3Button_link(string="Open in browser",{linkClass:"bp3-minimal bp3-fill bp3-align-left item-open-in-browser",icon:"share",iconModifier:"bp3-intent-primary",target:n.data.url,linkAttribute:'target="_blank"'}));var e=1==b.present?`data-uid="${b.uid}"`:"disabled",y=zoteroRoam.shortcuts.sequences.goToItemPage?zoteroRoam.shortcuts.makeSequenceText("goToItemPage",pre=" "):"",R=1==b.present?`${window.location.hash.match(/#\/app\/([^\/]+)/g)[0]}/page/${b.uid}`:"javascript:void(0)",R=`
            <div class="bp3-button-group bp3-minimal bp3-fill bp3-align-left">
            ${zoteroRoam.utils.renderBP3Button_link(string="Go to Roam page"+y,{linkClass:"item-go-to-page",icon:"arrow-right",iconModifier:"bp3-intent-primary",target:R,linkAttribute:e})}
            </div>
            `,e=`Import metadata  ${zoteroRoam.shortcuts.sequences.importMetadata?zoteroRoam.shortcuts.makeSequenceText("importMetadata",pre=" "):""}`,e=zoteroRoam.utils.renderBP3ButtonGroup(string=e,{buttonClass:"item-add-metadata",divClass:"bp3-minimal bp3-fill bp3-align-left",icon:"add",modifier:"bp3-intent-primary"});let w=zoteroRoam.formatting.getItemChildren(n,{pdf_as:"raw",notes_as:"raw"}),x="";if(w.remoteChildren)x+="<p>This item has children, but they were not returned by the API data request. This might be due to a request for 'items/top' rather than 'items'.</p>";else try{var $=w.pdfItems?w.pdfItems.map(e=>{var t="group"==e.library.type?`groups/${e.library.id}`:"library",t=["linked_file","imported_file","imported_url"].includes(e.data.linkMode)?`zotero://open-pdf/${t}/items/${e.data.key}`:e.data.url,e=e.data.filename||e.data.title;return zoteroRoam.utils.renderBP3Button_link(string=e,{linkClass:"bp3-minimal item-pdf-link",icon:"paperclip",target:t,linkAttribute:'target="_blank"'})}).join(""):"No PDF attachments";x+=$,w.notes&&($=zoteroRoam.shortcuts.sequences.toggleNotes?zoteroRoam.shortcuts.makeSequenceText("toggleNotes",pre=" "):"",x+=`${zoteroRoam.utils.renderBP3Button_group(string="Show Notes"+$,{buttonClass:"bp3-minimal bp3-align-left bp3-fill item-see-notes",icon:"comment"})}`,zoteroRoam.interface.search.overlay.querySelector(".side-panel-contents").innerHTML=`
                        <h4>Notes</h4>
                        <div class="item-rendered-notes">
                            ${w.notes.map(e=>e.data.note).join("<br>")}
                        </div>
                        `)}catch(e){console.log(w),console.log(pdfDiv),console.log(e),console.log("Something went wrong while getting the item's children data")}v.innerHTML=`
            <div class="item-additional-metadata">
                <p class="item-abstract bp3-running-text bp3-text-small bp3-blockquote">${n.data.abstractNote}</p>
                <p class="item-tags">${d}</p>
                <p class="item-collections">${g}</p>
            </div>
            <div class="item-actions">
                <div class="bp3-card">
                    ${k}
                    ${R}
                    ${e}
                </div>
                <div class="item-pdf-notes">
                    ${x}
                </div>
            </div>
            `;var S=b.uid||"";document.querySelector("button.item-add-metadata").addEventListener("click",function(){console.log("Importing metadata..."),zoteroRoam.handlers.importItemMetadata(r,S,{popup:!0})}),Array.from(document.querySelectorAll(".item-citekey-section .copy-buttons a.bp3-button[format]")).forEach(a=>{a.addEventListener("click",e=>{let t=zoteroRoam.interface.search.overlay.querySelector("input.clipboard-copy-utility");switch(a.getAttribute("format")){case"citekey":t.value=`${r}`;break;case"citation":var o=`${n.meta.creatorSummary||""}${s||""}`;t.value=`[${o}]([[${r}]])`;break;case"tag":t.value=`#[[${r}]]`;break;case"page-reference":t.value=`[[${r}]]`}t.select(),document.execCommand("copy")})});try{let t=document.querySelector("button.item-see-notes");t.addEventListener("click",function(){let e=t.querySelector(".bp3-button-text").innerHTML;switch(!0){case e.startsWith("Show"):zoteroRoam.interface.search.overlay.querySelector(".bp3-dialog").setAttribute("side-panel","visible"),t.querySelector(".bp3-button-text").innerHTML=e.replace("Show","Hide");break;case e.startsWith("Hide"):zoteroRoam.interface.search.overlay.querySelector(".bp3-dialog").setAttribute("side-panel","hidden"),t.querySelector(".bp3-button-text").innerHTML=e.replace("Hide","Show")}})}catch(e){}switch(document.querySelector("#zotero-roam-library-rendered").setAttribute("view","item"),zoteroRoam.interface.search.overlay.getAttribute("overlay-visible")){case"true":document.querySelector("h4.item-title").focus();break;case"false":zoteroRoam.interface.toggleSearchOverlay("show",{focus:!1})}},clearSelectedItem(){try{zoteroRoam.interface.search.selectedItemDiv.children.forEach(e=>{e.innerHTML=""})}catch(e){Array.from(zoteroRoam.interface.search.selectedItemDiv.children).forEach(e=>{e.innerHTML=""})}zoteroRoam.interface.search.overlay.querySelector(".side-panel-contents").innerHTML="","visible"==zoteroRoam.interface.search.overlay.querySelector(".bp3-dialog").getAttribute("side-panel")&&zoteroRoam.interface.search.overlay.querySelector(".bp3-dialog").setAttribute("side-panel","hidden"),document.querySelector("#zotero-roam-library-rendered").setAttribute("view","search")},checkEditingMode(){let e=document.querySelector("textarea.rm-block-input");e&&null==e.getAttribute("zotero-tribute")&&(document.querySelectorAll(".zotero-roam-tribute").forEach(e=>e.remove()),e.setAttribute("zotero-tribute","active"),new Tribute(zoteroRoam.config.tribute).attach(e),e.addEventListener("tribute-replaced",o=>{if("zotero"==o.detail.item.original.source){let e=document.querySelector("textarea.rm-block-input");var a=o.detail.context.mentionTriggerChar+o.detail.context.mentionText,r=o.detail.context.mentionPosition,i=o.detail.item.original.value;let t=o.target.defaultValue;o=zoteroRoam.utils.escapeRegExp(a),o=new RegExp(o,"g"),o=t.replaceAll(o,(e,t)=>t==r?i:e);zoteroRoam.interface.tributeTrigger=a,zoteroRoam.interface.tributeBlockTrigger=e,zoteroRoam.interface.tributeNewText=o,Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value").set.call(e,o);o=new Event("input",{bubbles:!0});e.dispatchEvent(o)}}))},triggerImport(e="citations",t=null){let o=document.querySelector(`[zr-import="${e}"]`);var a=("citations"==e?zoteroRoam.citations:zoteroRoam.webImport).activeImport;null==a?(zoteroRoam.data.roamPages=zoteroRoam.utils.getRoamPages(),zoteroRoam.activeImport.libraries=zoteroRoam.utils.getLibraries(),zoteroRoam.interface.renderImportOptions(e)):"citations"==e&&o.querySelector('button[role="done"]')&&zoteroRoam.interface.clearImportPanel(action="reset",e),"citations"==e?zoteroRoam.interface.renderImportCitations(t):"weblinks"==e&&zoteroRoam.interface.renderImportWeblinks(),!!a&&0<a.items.length&&zoteroRoam.activeImport.currentLib?o.querySelector('button[role="add"]').removeAttribute("disabled"):o.querySelector('button[role="add"]').setAttribute("disabled","")},renderImportCitations(e){let t=document.querySelector('[zr-import="citations"]');var o=e.querySelector(".zotero-roam-citation-identifier-link").innerText,a=e.querySelector(".zotero-roam-search-item-title").innerText,r=e.querySelector(".zotero-roam-citation-origin").innerText;null==zoteroRoam.citations.activeImport?(zoteroRoam.citations.activeImport={items:[],outcome:null},zoteroRoam.tagSelection.autocomplete.init(),zoteroRoam.interface.triggerImport(type="citations",e),t.querySelector(".bp3-dialog").setAttribute("side-panel","visible")):zoteroRoam.citations.activeImport.items.includes(o)||(zoteroRoam.citations.activeImport.items.push(o),t.querySelector(".import-items").innerHTML+=`
                    <li class="import-items_selected" data-identifier="${o}">
                    <div class="selected_info">
                    <span class="selected_title bp3-text-muted">${a}</span>
                    <span class="selected_origin">${r}</span>
                    </div>
                    <div class="selected_state">
                    ${zoteroRoam.utils.renderBP3Button_group(string="",{buttonClass:"bp3-small bp3-minimal bp3-intent-danger selected_remove-button",icon:"cross"})}
                    </div>
                    </li>
                    `,t.querySelector(".import-selection-header").innerText=`Selected Items (${zoteroRoam.citations.activeImport.items.length})`)},renderImportWeblinks(){if(null!=zoteroRoam.webImport.activeImport){let e=Array.from(document.querySelectorAll('[name="explo-weblink"]')).filter(e=>e.checked);zoteroRoam.webImport.activeImport.items=e.map(e=>zoteroRoam.webImport.activeImport.harvest[Number(e.getAttribute("value"))])}},renderImportOptions(e="citations"){let t=document.querySelector(`[zr-import="${e}"]`),o=zoteroRoam.activeImport.libraries;e=zoteroRoam.utils.renderBP3_list(o,"radio",{varName:"library",has_value:"path",has_string:"name",selectFirst:!0,active_if:"writeable"});let a="",r=o.find(e=>1==e.writeable);r&&(zoteroRoam.activeImport.currentLib=r,a=zoteroRoam.utils.renderBP3_list(r.collections.map(e=>({name:e.data.name,key:e.key,depth:e.depth})),"checkbox",{varName:"collections",has_value:"key",has_string:"name"})),t.querySelector(".options-library-list").innerHTML=e,t.querySelector(".options-collections-list").innerHTML=a},renderImportResults(n){zoteroRoam.citations.activeImport.items.forEach(t=>{let e=zoteroRoam.interface.citations.overlay.querySelector(`.import-items_selected[data-identifier="${t}"]`);var o=n.harvest.find(e=>e.query==t);switch(o.success){case null:e.querySelector(".selected_state").innerHTML=`<span icon="ban-circle" class="bp3-icon bp3-icon-ban-circle bp3-intent-danger" title="${o.error.name} : ${o.error.message}"></span>`;break;case!1:e.querySelector(".selected_state").innerHTML=`<span icon="error" class="bp3-icon bp3-icon-error bp3-intent-warning" title="${o.response.status}"></span>`;break;case!0:var a=o.data,r=n.write;switch(r.success){case null:e.querySelector(".selected_state").innerHTML=`<span icon="ban-circle" class="bp3-icon bp3-icon-ban-circle bp3-intent-danger" title="${r.error.name} : ${r.error.message}"></span>`;break;case!1:e.querySelector(".selected_state").innerHTML=`<span icon="error" class="bp3-icon bp3-icon-error bp3-intent-warning" title="${r.response.status} : ${r.response.statusText}"></span>`;break;case!0:var i=Object.values(r.data.successful).find(e=>e.data.title==a.title&&e.data.url==a.url);i&&(e.querySelector(".selected_state").innerHTML=`<span icon="tick" class="bp3-icon bp3-icon-tick bp3-intent-success" title="${i.data.key}"></span>`)}}});let e=zoteroRoam.interface.citations.overlay.querySelector('button[role="add"]');e.classList.remove("bp3-intent-primary"),e.querySelector(".bp3-icon").classList.remove("bp3-icon-inheritance"),e.querySelector(".bp3-icon").classList.add("bp3-icon-tick"),e.querySelector(".bp3-icon").setAttribute("icon","tick"),e.querySelector(".bp3-button-text").innerText="Done",e.classList.add("bp3-intent-success"),e.removeAttribute("disabled"),e.setAttribute("role","done")},selectImportLibrary(e="citations"){let t=document.querySelector(`[zr-import="${e}"]`);var e=zoteroRoam.activeImport.currentLib.path,o=Array.from(t.querySelectorAll('.options-library-list [name="library"]')).find(e=>1==e.checked).value;o!=e&&(zoteroRoam.activeImport.currentLib=zoteroRoam.activeImport.libraries.find(e=>e.path==o),e=zoteroRoam.utils.renderBP3_list(zoteroRoam.activeImport.currentLib.collections.map(e=>({name:e.data.name,key:e.key})),"checkbox",{varName:"collections",has_value:"key",has_string:"name"}),t.querySelector(".options-collections-list").innerHTML=e)},clearImportPanel(e="close",t="citations"){let o=document.querySelector(`[zr-import="${t}"]`);switch(e){case"close":o.closest(".bp3-dialog").setAttribute("side-panel","hidden"),"citations"==t?zoteroRoam.citations.activeImport=null:"weblinks"==t&&(zoteroRoam.webImport.activeImport=null),o.querySelector(".options-library-list").innerHTML="",o.querySelector(".options-collections-list").innerHTML="";break;case"reset":"citations"==t?(zoteroRoam.citations.activeImport.items=[],zoteroRoam.citations.activeImport.outcome=null):"weblinks"==t&&(Array.from(o.querySelectorAll('[name="explo-weblink"]')).forEach(e=>{e.checked=!1}),o.querySelectorAll('[name="selectAll"]').checked=!1)}let a=o.querySelector('button[role="done"]');a&&(a.classList.remove("bp3-intent-success"),a.querySelector(".bp3-icon").classList.remove("bp3-icon-tick"),a.querySelector(".bp3-icon").classList.add("bp3-icon-inheritance"),a.querySelector(".bp3-icon").setAttribute("icon","inheritance"),a.querySelector(".bp3-button-text").innerText="Add to Zotero",a.classList.add("bp3-intent-primary"),a.setAttribute("role","add")),o.querySelector('button[role="add"]').setAttribute("disabled",""),"citations"==t&&(o.querySelector(".zotero-roam-import-tags-list").value="",o.querySelector(".options-tags_selection").innerHTML="",o.querySelector(".options-tags_selection").dataset.tags="[]",o.querySelector(".import-selection-header").innerText="Selected Items",o.querySelector(".import-items").innerHTML="")}},zoteroRoam.extension={async load(){zoteroRoam.interface.icon.style="background-color: #fd9d0d63!important;";var e=await zoteroRoam.handlers.requestData(zoteroRoam.config.requests);if(!e.success)throw zoteroRoam.interface.icon.style="background-color:#f9a3a3 !important",zoteroRoam.interface.popToast(message="There was a problem with the Zotero data request. Please check your specification !",intent="danger"),new Error("The API request encountered a problem. Please check your request specification, and the console for any registered errors.");try{let t=[];Array.from(new Set(zoteroRoam.config.requests.map(e=>e.apikey))).forEach(e=>{t.push(fetch(`https://api.zotero.org/keys/${e}`,{method:"GET",headers:{"Zotero-API-Version":3,"Zotero-API-Key":e}}))});let e=await Promise.all(t);e=await Promise.all(e.map(e=>e.json())),e=e.flat(1),zoteroRoam.data.keys=e}catch(e){console.error(e)}zoteroRoam.data.items=e.data.items,zoteroRoam.data.collections=e.data.collections,zoteroRoam.interface.icon.setAttribute("status","on"),zoteroRoam.inPage.checkReferences(),document.addEventListener("blur",zoteroRoam.inPage.checkReferences,!0),window.addEventListener("locationchange",zoteroRoam.inPage.checkReferences,!0),zoteroRoam.config.ref_checking=setInterval(zoteroRoam.inPage.checkReferences,1e3),zoteroRoam.utils.sleep(100),zoteroRoam.inPage.addPageMenus(wait=0),window.addEventListener("locationchange",zoteroRoam.inPage.addPageMenus,!0),zoteroRoam.config.page_checking=setInterval(function(){zoteroRoam.inPage.addPageMenus(wait=0)},1e3),zoteroRoam.config.userSettings.webimport&&(zoteroRoam.config.tag_checking=setInterval(function(){zoteroRoam.inPage.addWebImport()},1e3)),zoteroRoam.config.userSettings.autoupdate&&(zoteroRoam.config.auto_update=setInterval(function(){zoteroRoam.extension.update(popup=!1)},6e4)),null==zoteroRoam.librarySearch.autocomplete?zoteroRoam.librarySearch.autocomplete=new autoComplete(zoteroRoam.config.autoComplete):zoteroRoam.librarySearch.autocomplete.init(),1==zoteroRoam.config.params.autocomplete.enabled&&(zoteroRoam.config.editingObserver=new MutationObserver(zoteroRoam.interface.checkEditingMode),zoteroRoam.config.editingObserver.observe(document,{childList:!0,subtree:!0})),null==zoteroRoam.tagSelection.autocomplete?zoteroRoam.tagSelection.autocomplete=new autoComplete(zoteroRoam.config.tagSelection):zoteroRoam.tagSelection.autocomplete.init(),zoteroRoam.interface.icon.addEventListener("contextmenu",zoteroRoam.interface.popIconContextMenu),window.addEventListener("keyup",zoteroRoam.shortcuts.verify),window.addEventListener("keydown",zoteroRoam.shortcuts.verify),roamAlphaAPI.ui.commandPalette.addCommand({label:"zoteroRoam : Open the search panel",callback:()=>{zoteroRoam.interface.toggleSearchOverlay("show")}}),zoteroRoam.events.emit("ready",detail=zoteroRoam.data),zoteroRoam.interface.icon.style="background-color: #60f06042!important;",zoteroRoam.interface.popToast(message="Zotero data successfully loaded !",intent="success"),console.log("The results of the API request have been received ; you can check them by inspecting the value of the zoteroRoam.data object. Data import context menu should now be available.")},unload(){zoteroRoam.interface.icon.setAttribute("status","off"),zoteroRoam.data.items=[],zoteroRoam.data.collections=[],zoteroRoam.data.semantic=[],zoteroRoam.data.keys=[],zoteroRoam.data.libraries=zoteroRoam.data.libraries.map(e=>(e.version="0",e)),null!==zoteroRoam.librarySearch.autocomplete&&zoteroRoam.librarySearch.autocomplete.unInit(),null!==zoteroRoam.citations.autocomplete&&zoteroRoam.citations.autocomplete.unInit(),null!==zoteroRoam.tagSelection.autocomplete&&zoteroRoam.tagSelection.autocomplete.unInit(),Array.from(document.querySelectorAll(".zotero-roam-page-div")).forEach(e=>e.remove());let e=document.querySelectorAll("ref-citekey");e.forEach(e=>{e.removeAttribute("data-zotero-bib"),e.querySelector(".rm-page-ref").removeEventListener("contextmenu",zoteroRoam.interface.popContextMenu)}),zoteroRoam.interface.icon.removeEventListener("contextmenu",zoteroRoam.interface.popIconContextMenu),document.removeEventListener("blur",zoteroRoam.inPage.checkReferences,!0),window.removeEventListener("locationchange",zoteroRoam.inPage.checkReferences,!0);try{clearInterval(zoteroRoam.config.ref_checking)}catch(e){}try{clearInterval(zoteroRoam.config.page_checking)}catch(e){}try{clearInterval(zoteroRoam.config.tag_checking)}catch(e){}try{clearInterval(zoteroRoam.config.auto_update)}catch(e){}try{zoteroRoam.config.editingObserver.disconnect()}catch(e){}window.removeEventListener("keyup",zoteroRoam.shortcuts.verify),window.removeEventListener("keydown",zoteroRoam.shortcuts.verify),roamAlphaAPI.ui.commandPalette.removeCommand({label:"zoteroRoam : Open the search panel"}),zoteroRoam.interface.icon.removeAttribute("style"),zoteroRoam.interface.popToast(message="All Zotero data was cleared. Bye for now !",intent="success"),console.log("Data and request outputs have been removed")},toggle(){"off"==zoteroRoam.interface.icon.getAttribute("status")?zoteroRoam.extension.load():zoteroRoam.extension.unload()},async update(t="true",e=zoteroRoam.config.requests){zoteroRoam.interface.icon.style="background-color: #fd9d0d63!important;";e=e.map(t=>{var e=zoteroRoam.data.libraries.find(e=>e.path==t.library).version,{apikey:o,dataURI:a,params:r,name:i,library:n}=t;let s=new URLSearchParams(r);return s.set("since",e),{apikey:o,dataURI:a,params:s.toString(),name:i,library:n}});let o=await zoteroRoam.handlers.requestData(e,update=!0,collections=!0);if(1==o.success){o.data.collections.forEach(t=>{var e=zoteroRoam.data.collections.findIndex(e=>e.key==t.key);-1==e?zoteroRoam.data.collections.push(t):zoteroRoam.data.collections[e]=t});let e=o.data.items;if(0==e.length)t&&zoteroRoam.interface.popToast("No new items were found since the data was last loaded. Data on collections was refreshed.","primary"),zoteroRoam.interface.icon.style="background-color: #60f06042!important;";else{let o=zoteroRoam.handlers.extractCitekeys(e).length,a=0;e.forEach(t=>{var e=zoteroRoam.data.items.findIndex(e=>e.data.key==t.data.key&e.requestLabel==t.requestLabel);-1==e?zoteroRoam.data.items.push(t):(zoteroRoam.data.items[e]=t,a+=1,--o)}),zoteroRoam.inPage.checkCitekeys(update=!0),t?zoteroRoam.interface.popToast(`${o} new items and ${a} modified items were added.`,"primary"):console.log(`${o} new items and ${a} modified items were added.`),zoteroRoam.interface.icon.style="background-color: #60f06042!important;"}}else t?zoteroRoam.interface.popToast("Something went wrong when updating the data. Check the console for any errors.","warning"):console.log("Something went wrong when updating the data. Check the console for any errors.");zoteroRoam.events.emit("update",{success:o.success,requests:e,data:o.data})}},zoteroRoam.inPage={addContextMenuListener(){for(var e=document.querySelectorAll(".ref-citekey"),t=0;t<e.length;t++){var o=e[t];o.dataset.zoteroBib||(zoteroRoam.data.items.find(e=>e.key==o.dataset.linkTitle.replace("@",""))?o.dataset.zoteroBib="inLibrary":o.dataset.zoteroBib="notFound"),"inLibrary"==o.dataset.zoteroBib&&o.querySelector(".rm-page-ref").addEventListener("contextmenu",zoteroRoam.interface.popContextMenu)}},checkReferences(e=!1){var t;setTimeout(function(){do{var e=document.getElementsByClassName("rm-page-ref");t=zoteroRoam.inPage.identifyCitekeys(e)}while(1==t)},300),zoteroRoam.inPage.checkCitekeys(e),zoteroRoam.inPage.addContextMenuListener()},identifyCitekeys(t){let o=!1;for(i=0;i<t.length;i++){let e=t[i].parentElement;void 0!==e.dataset.linkTitle&&e.dataset.linkTitle.startsWith("@")&&(o=!e.classList.contains("ref-citekey")&&(e.classList.add("ref-citekey"),!0))}return o},checkCitekeys(e=!1){let t=document.querySelectorAll(".ref-citekey"),o=0,a=0;t.forEach(t=>{if(t.dataset.zoteroBib)1==e&&"notFound"==t.dataset.zoteroBib&&(zoteroRoam.data.items.find(e=>e.key==t.dataset.linkTitle.replace("@",""))?(t.dataset.zoteroBib="inLibrary",o+=1):a+=1);else switch(t.dataset.zoteroBib=zoteroRoam.data.items.find(e=>e.key==t.dataset.linkTitle.replace("@",""))?"inLibrary":"notFound",t.dataset.zoteroBib){case"inLibrary":o+=1;break;case"notFound":a+=1}}),0<o|0<a&&console.log(`New matched citekeys: ${o}, New unmatched citekeys: ${a}`)},convertToCitekey(t){var r=zoteroRoam.data.items.find(e=>e.key==t.innerText.slice(1));let e=t.closest(".roam-block");var o=e.id.slice(-9),a=Array.from(e.querySelectorAll(".ref-citekey")).findIndex(e=>e==t.parentNode),i=window.roamAlphaAPI.q("[:find ?text :in $ ?uid :where[?b :block/uid ?uid][?b :block/string ?text]]",o)[0];if(0<i.length){let e=i[0];a=new RegExp(`(.*?(?:\\[\\[@.+?\\]\\].*?){${a}})(\\[\\[@.+?\\]\\])(.*)`,"g"),a=e.replace(a,(e,t,o,a)=>`${t}${zoteroRoam.utils.formatItemReference(r,"citation")}${a}`);window.roamAlphaAPI.updateBlock({block:{uid:o,string:a}})}},async addPageMenus(e=100){var n;zoteroRoam.utils.sleep(e);for(const s of Array.from(document.querySelectorAll("h1.rm-title-display")))if(!s.parentElement.querySelector(".zotero-roam-page-div")&&!s.parentElement.querySelector(".zotero-roam-page-related")){let i=(s.querySelector("span")?s.querySelector("span"):s).innerText;if(zoteroRoam.config.params.pageMenu.trigger(i))if(i.startsWith("@")){var t=i.slice(1),o=zoteroRoam.data.items.find(e=>e.key==t);if(void 0!==o)zoteroRoam.inPage.renderCitekeyMenu(item=o,i,elem=s);else try{s.parentElement.querySelector(".zotero-roam-page-div").remove()}catch(e){}}else if(i.match(/(.+) ([0-9]+).{2}, ([0-9]{4})/g)){let t=zoteroRoam.utils.findSameDay(zoteroRoam.utils.readDNP(i));if(0<t.length){o=t.map(e=>e.key);let e=document.createElement("div");e.classList.add("zotero-roam-page-related"),e.classList.add("bp3-button-group"),e.classList.add("bp3-minimal"),e.classList.add("bp3-align-left"),e.classList.add("bp3-vertical"),e.innerHTML=zoteroRoam.utils.renderBP3Button_group(string=`${t.length} item${1<t.length?"s":""} added`,{icon:"calendar",buttonClass:"zotero-roam-page-added-on",buttonAttribute:`data-title="${i}" data-keys=${JSON.stringify(o)}`}),s.parentElement.style.overflow="auto",s.insertAdjacentElement("afterend",e)}}else{let a=zoteroRoam.data.items.filter(e=>e.data.tags&&e.data.tags.map(e=>e.tag).includes(i)),r=zoteroRoam.data.items.filter(e=>e.data.abstractNote&&e.data.abstractNote.includes(i));if(0<a.length||0<r.length){let e=document.createElement("div");e.classList.add("zotero-roam-page-related"),e.classList.add("bp3-button-group"),e.classList.add("bp3-minimal"),e.classList.add("bp3-align-left"),e.classList.add("bp3-vertical");let t="";0<a.length&&(n=a.map(e=>e.key),t=zoteroRoam.utils.renderBP3Button_group(`${a.length} tagged item${1<a.length?"s":""}`,{icon:"manual",buttonClass:"zotero-roam-page-tagged-with",buttonAttribute:`data-title="${i}" data-keys=${JSON.stringify(n)}`}));let o="";0<r.length&&(n=r.map(e=>e.key),o=zoteroRoam.utils.renderBP3Button_group(`${r.length} abstract${1<r.length?"s":""}`,{icon:"manually-entered-data",buttonClass:"zotero-roam-page-abstract-mentions",buttonAttribute:`data-title="${i}" data-keys=${JSON.stringify(n)}`})),e.innerHTML=`
                        ${t}
                        ${o}
                        `,s.parentElement.style.overflow="auto",s.insertAdjacentElement("afterend",e)}}}},makeSciteBadge(e,{layout:t="horizontal",showZero:o="true",showLabels:a="false",tooltip:r="bottom"}={}){let i=document.createElement("div");return i.classList.add("scite-badge"),i.setAttribute("data-doi",e),i.setAttribute("data-layout",t),i.setAttribute("data-show-zero",o),i.setAttribute("data-show-labels",a),i.setAttribute("data-tooltip-placement",r),i},async handleClicks(i){if(i.closest(".zotero-roam-page-div")){var a,r=i.closest(".zotero-roam-page-div");let e=r.dataset.title,t=r.dataset.uid,o=i.closest("button");if(o)if(o.classList.contains("zotero-roam-page-menu-add-metadata"))console.log(`Importing metadata to ${e} (${t})...`),zoteroRoam.handlers.importItemMetadata(e,t,{popup:!0});else if(o.classList.contains("zotero-roam-page-menu-import-notes"))console.log(`Adding notes to ${e} (${t})...`),zoteroRoam.handlers.addItemNotes(e,t);else if(o.classList.contains("zotero-roam-page-menu-view-item-info"))zoteroRoam.interface.renderItemInPanel(citekey=e);else if(o.classList.contains("zotero-roam-page-menu-backlinks-button")){let e=o.querySelector(".bp3-icon-caret-down"),t=o.parentElement.querySelector(".zotero-roam-page-menu-backlinks-list");Array.from(e.classList).includes("rm-caret-closed")&&t?(e.classList.replace("rm-caret-closed","rm-caret-open"),t.style.display="flex"):Array.from(e.classList).includes("rm-caret-open")&&(e.classList.replace("rm-caret-open","rm-caret-closed"),t.style.display="none")}else o.classList.contains("zotero-roam-page-menu-backlink-open-sidebar")?zoteroRoam.utils.addToSidebar(t=o.dataset.uid):o.classList.contains("zotero-roam-page-menu-backlink-add-sidebar")?(a=roamAlphaAPI.util.generateUID(),roamAlphaAPI.createPage({page:{title:o.dataset.title,uid:a}}),await zoteroRoam.handlers.importItemMetadata(e=o.dataset.title,t=a,{popup:!1}),zoteroRoam.utils.addToSidebar(t=a)):o.classList.contains("zotero-roam-page-menu-backlinks-total")?(r=o.getAttribute("data-doi"),a=o.getAttribute("data-citekey"),zoteroRoam.interface.popCitationsOverlay(r,a,type="citations")):o.classList.contains("zotero-roam-page-menu-references-total")&&(n=o.getAttribute("data-doi"),s=o.getAttribute("data-citekey"),zoteroRoam.interface.popCitationsOverlay(n,s,type="references"))}else if(i.closest(".zotero-roam-page-related")){let e=i.closest("button");var n,s;e&&(n=e.dataset.title,s=JSON.parse(e.dataset.keys),e.classList.contains("zotero-roam-page-added-on")?zoteroRoam.interface.popRelatedDialog(n,s,type="added-on"):e.classList.contains("zotero-roam-page-tagged-with")?zoteroRoam.interface.popRelatedDialog(n,s,type="tagged-with"):e.classList.contains("zotero-roam-page-abstract-mentions")&&zoteroRoam.interface.popRelatedDialog(n,s,type="abstract-mention"))}else if(i.closest(".zotero-roam-explo-import")){let e=i.closest(".rm-block");i=e.querySelectorAll(".rm-block a:not(.rm-alias--page):not(.rm-alias--block)");let t=Array.from(i).map(e=>e.href);zoteroRoam.webImport.currentBlock=e.querySelector(".rm-block-main .roam-block");let o=document.querySelector(".zotero-roam-auxiliary-overlay");o.querySelector(".main-panel .header-left").innerHTML="",o.querySelector(".main-panel .rendered-div").innerHTML="<p>Parsing links...</p>",o.querySelector(".bp3-dialog").setAttribute("side-panel","visible"),zoteroRoam.interface.triggerImport(type="weblinks"),o.style.display="block",o.setAttribute("overlay-visible","true");let a=[];t.forEach(e=>{a.push(zoteroRoam.handlers.requestCitoid(query=e))});let r=await Promise.all(a);zoteroRoam.webImport.activeImport={items:null};i=r.filter(e=>1==e.success);0<i.length?zoteroRoam.interface.fillWebImportDialog(i):o.querySelector(".main-panel .rendered-div").innerHTML="<p>No data successfully retrieved</p>"}},async renderCitekeyMenu(o,i,n){var s=i.slice(1),l=zoteroRoam.utils.parseDOI(o.data.DOI)||"",c=zoteroRoam.utils.lookForPage(i);let m=zoteroRoam.formatting.getItemChildren(o,{pdf_as:"raw",notes_as:"raw"}),d=zoteroRoam.config.params.pageMenu.defaults,p=n.parentElement.querySelector(".zotero-roam-page-div");if(null==p){p=document.createElement("div"),p.classList.add("zotero-roam-page-div"),p.setAttribute("data-uid",c.uid),p.setAttribute("data-title",i),p.innerHTML=l?`
                <span class="zotero-roam-page-doi" data-doi="${l}">
                <a href="https://doi.org/${l}" class="bp3-text-muted" target="_blank">${l}</a>
                </span>
                `:"",n.insertAdjacentElement("afterend",p);let e=n.parentElement.querySelector(".zotero-roam-page-menu");null==e&&(e=document.createElement("div"),e.classList.add("zotero-roam-page-menu"),e.classList.add("bp3-card"),zoteroRoam.config.params.theme&&e.classList.add(zoteroRoam.config.params.theme),p.appendChild(e));var u=d.includes("addMetadata")?zoteroRoam.utils.renderBP3Button_group(string="Add metadata",{buttonClass:"bp3-minimal zotero-roam-page-menu-add-metadata",icon:"add"}):"",g=d.includes("importNotes")&&m.notes?zoteroRoam.utils.renderBP3Button_group(string="Import notes",{buttonClass:"bp3-minimal zotero-roam-page-menu-import-notes",icon:"comment"}):"",b=d.includes("viewItemInfo")?zoteroRoam.utils.renderBP3Button_group(string="View item information",{buttonClass:"bp3-minimal zotero-roam-page-menu-view-item-info",icon:"info-sign"}):"",y=d.includes("openZoteroLocal")?zoteroRoam.utils.renderBP3Button_link(string="Open in Zotero",{linkClass:"bp3-minimal zotero-roam-page-menu-open-zotero-local",target:zoteroRoam.formatting.getLocalLink(o,{format:"target"}),linkAttribute:'target="_blank"',icon:"application"}):"",h=d.includes("openZoteroWeb")?zoteroRoam.utils.renderBP3Button_link(string="Open in Zotero",{linkClass:"bp3-minimal zotero-roam-page-menu-open-zotero-web",target:zoteroRoam.formatting.getWebLink(o,{format:"target"}),linkAttribute:'target="_blank"',icon:"cloud"}):"",f=d.includes("pdfLinks")&&m.pdfItems?m.pdfItems.map(e=>{var t="group"==e.library.type?`groups/${e.library.id}`:"library",t=["linked_file","imported_file","imported_url"].includes(e.data.linkMode)?`zotero://open-pdf/${t}/items/${e.data.key}`:e.data.url,e=e.data.filename||e.data.title;return zoteroRoam.utils.renderBP3Button_link(string=e,{linkClass:"bp3-minimal zotero-roam-page-menu-pdf-link",icon:"paperclip",target:t,linkAttribute:'target="_blank"'})}).join(""):"";let t=[];d.includes("connectedPapers")&&t.push(zoteroRoam.utils.renderBP3Button_link(string="Connected Papers",{icon:"layout",linkClass:"bp3-minimal bp3-intent-primary zotero-roam-page-menu-connected-papers",linkAttribute:'target="_blank"',target:`https://www.connectedpapers.com/${o.data.DOI?"api/redirect/doi/"+l:"search?q="+encodeURIComponent(o.data.title)}`})),d.includes("semanticScholar")&&t.push(l?zoteroRoam.utils.renderBP3Button_link(string="Semantic Scholar",{icon:"bookmark",linkClass:"bp3-minimal bp3-intent-primary zotero-roam-page-menu-semantic-scholar",linkAttribute:'target="_blank"',target:`https://api.semanticscholar.org/${l}`}):""),d.includes("googleScholar")&&t.push(zoteroRoam.utils.renderBP3Button_link(string="Google Scholar",{icon:"learning",linkClass:"bp3-minimal bp3-intent-primary zotero-roam-page-menu-google-scholar",linkAttribute:'target="_blank"',target:`https://scholar.google.com/scholar?q=${o.data.DOI?l:encodeURIComponent(o.data.title)}`}));let a="",r=null;try{if(d.includes("citingPapers")&&l&&(r=await zoteroRoam.handlers.getSemantic(l),r.data)){var z=r.citations.filter(e=>e.doi).map(e=>e.doi),v=r.references.filter(e=>e.doi).map(e=>e.doi);let t=[...z,...v];if(0<t.length){let e=zoteroRoam.data.items.filter(e=>zoteroRoam.utils.parseDOI(e.data.DOI)),o=t.map(t=>e.find(e=>zoteroRoam.utils.parseDOI(e.data.DOI).toLowerCase()==t.toLowerCase())).filter(Boolean);o.forEach((e,t)=>{e=zoteroRoam.utils.parseDOI(e.data.DOI)||"";zoteroRoam.utils.includes_anycase(z,e)?o[t].type="citing":o[t].type="cited"}),a="",a+=zoteroRoam.utils.renderBP3Button_group(string=`${0<r.references.length?r.references.length:"No"} references`,{buttonClass:"bp3-minimal bp3-intent-primary zotero-roam-page-menu-references-total",icon:"citation",buttonAttribute:`data-doi="${l}" data-citekey="${s}" ${0<v.length?"":"disabled"}`}),a+=zoteroRoam.utils.renderBP3Button_group(string=`${0<r.citations.length?r.citations.length:"No"} citing papers`,{buttonClass:"bp3-minimal bp3-intent-warning zotero-roam-page-menu-backlinks-total",icon:"chat",buttonAttribute:`data-doi="${l}" data-citekey="${s}" ${0<z.length?"":"disabled"}`}),a+=zoteroRoam.utils.renderBP3Button_group(string=`${0<o.length?o.length:"No"} related library items`,{buttonClass:`bp3-minimal ${0<o.length?"":"bp3-disabled"} zotero-roam-page-menu-backlinks-button`,icon:"caret-down bp3-icon-standard rm-caret rm-caret-closed"}),0<o.length&&(a+=`
                                    <ul class="zotero-roam-page-menu-backlinks-list bp3-list-unstyled bp3-text-small" style="display:none;">
                                    ${zoteroRoam.inPage.renderBacklinksList(o)}
                                    </ul>
                                    `)}}}catch(e){console.log(`Citations rendering error : ${e}`)}e.innerHTML=`
                <div class="zotero-roam-page-menu-header">
                <div class="zotero-roam-page-menu-actions bp3-button-group">
                ${u}
                ${g}
                ${b}
                ${y}
                ${h}
                ${f}
                ${0==t.length?"":t.join("\n")}
                </div>
                </div>
                <div class="zotero-roam-page-menu-citations" ${l?`data-doi="${l}"`:""}>
                ${a}
                </div>
                `,d.includes("sciteBadge")&&o.data.DOI&&null==n.parentElement.querySelector(".scite-badge")&&(f=zoteroRoam.inPage.makeSciteBadge(doi=l),n.parentElement.querySelector(".zotero-roam-page-menu-header").appendChild(f),window.__SCITE.insertBadges()),zoteroRoam.events.emit("menu-ready",{title:i,item:o,doi:l,uid:c.uid,children:m,semantic:r,div:p,context:p.closest(".roam-article")?"main":"sidebar"})}},renderBacklinksItem(e,t,o=null){var a="reference"==t?"citation":"chat";return o?`
                <li class="related-item_listed bp3-blockquote" item-type="${t}" data-key="@${e.key}" in-graph="true">
                <div class="related_info">
                <a href="${window.location.hash.match(/#\/app\/([^\/]+)/g)[0]}/page/${o}"><span><span class="bp3-icon bp3-icon-${a}"></span>${zoteroRoam.utils.formatItemReference(e,"zettlr_accent")}</span></a>
                </div>
                <div class="related_state">
                ${zoteroRoam.utils.renderBP3Button_group(string="",{buttonClass:"bp3-minimal zotero-roam-page-menu-backlink-open-sidebar",icon:"inheritance",buttonAttribute:`data-uid="${o}" title="Open in sidebar"`})}
                </div>
                </li>`:`
                <li class="related-item_listed bp3-blockquote" item-type="${t}" data-key="@${e.key}" in-graph="false">
                <div class="related_info">
                <span><span class="bp3-icon bp3-icon-${a}"></span>${zoteroRoam.utils.formatItemReference(e,"zettlr_accent")}</span>
                </div>
                <div class="related_state">
                ${zoteroRoam.utils.renderBP3Button_group(string="",{buttonClass:"bp3-minimal zotero-roam-page-menu-backlink-add-sidebar",icon:"add",buttonAttribute:`data-title="@${e.key}" title="Add & open in sidebar"`})}
                </div>
                </li>`},renderBacklinksList(e){let t=e.filter(e=>"citing"==e.type),o=e.filter(e=>"cited"==e.type),a=[],r=[];0<o.length&&(a=o.sort((e,t)=>e.meta.creatorSummary<t.meta.creatorSummary?-1:1).map(e=>{var t=zoteroRoam.utils.lookForPage("@"+e.key).uid||null;return zoteroRoam.inPage.renderBacklinksItem(e,"reference",uid=t)})),0<t.length&&(r=t.sort((e,t)=>e.meta.creatorSummary<t.meta.creatorSummary?-1:1).map(e=>{var t=zoteroRoam.utils.lookForPage("@"+e.key).uid||null;return zoteroRoam.inPage.renderBacklinksItem(e,"citation",uid=t)}));let i=[...a,...r];e=Math.ceil(i.length/2);let n=[],s=[];return s=a.length>e?(n=a.slice(0,e),[...r,...a.slice(e)]):(n=i.slice(0,e),i.slice(e)),`
            <ul class="col-1-left bp3-list-unstyled">
            ${n.join("")}
            </ul>
            <ul class="col-2-right bp3-list-unstyled">
            ${s.join("")}
            </ul>
            `},addWebImport(){var e=zoteroRoam.config.params.webimport.tags,t=e.constructor===Array?e:[e];let a=document.createElement("button");a.setAttribute("type","button"),a.classList.add("bp3-button"),a.classList.add("bp3-minimal"),a.classList.add("zotero-roam-explo-import"),a.innerHTML='<span icon="geosearch" class="bp3-icon bp3-icon-geosearch"></span>';let o=Array.from(document.querySelectorAll(".rm-block:not(.rm-block--ghost)")).filter(e=>zoteroRoam.utils.matchArrays(t,JSON.parse(e.getAttribute("data-page-links"))));o.forEach(e=>{var t=e.querySelectorAll(".rm-block a:not(.rm-alias--page):not(.rm-alias--block)");let o=e.firstChild;0<t.length?(e.setAttribute("data-zr-explo","true"),Array.from(o.classList).includes("bp3-icon-geosearch")||e.insertAdjacentElement("afterbegin",a.cloneNode(!0))):(e.setAttribute("data-zr-explo","false"),Array.from(o.classList).includes("bp3-icon-geosearch")&&o.remove())})}},zoteroRoam.formatting={getCreators(e,{creators_as:t="string",brackets:o=!0,use_type:a=!0}={}){let r=e.data.creators.map(e=>{var t=e.name?`${e.name}`:`${[e.firstName,e.lastName].filter(Boolean).join(" ")}`;return{name:t,type:e.creatorType,inGraph:zoteroRoam.utils.lookForPage(t)}});switch(t){case"identity":return r;case"array":return r.map(e=>e.name);case"string":default:return(1==a?r.map(e=>{return(1==o?`[[${e.name}]]`:e.name)+("author"==e.type?"":`(${e.type})`)}):r.map(e=>1==o?`[[${e.name}]]`:e.name)).join(", ")}},async getItemBib(e,{include:t="bib",style:o="apa",linkwrap:a=0,locale:r="en-US"}={}){r=e.bib||await zoteroRoam.handlers.requestItemBib(e,{include:t,style:o,linkwrap:a,locale:r});return zoteroRoam.utils.formatBib(r)},getChildrenInDataset(t){var e=zoteroRoam.data.items.filter(e=>e.data.parentItem==t.data.key&e.library.id==t.library.id);return 0<e.length&&e},getItemChildren(t,{pdf_as:o="links",notes_as:e="formatted",split_char:a=zoteroRoam.config.params.notes.split_char}={}){let r={pdfItems:!1,notes:!1},i=[];var n=zoteroRoam.formatting.getChildrenInDataset(t);switch(n?i=n:0<t.meta.numChildren&&(r.remoteChildren=!0),o){case"raw":var s=i.filter(e=>"application/pdf"==e.data.contentType);r.pdfItems=0!=s.length&&s;break;case"identity":let e=i.filter(e=>"application/pdf"==e.data.contentType);r.pdfItems=0!=e.length&&e.map(e=>({title:e.data.title,key:e.key,link:zoteroRoam.utils.makePDFLinks(e)}));break;case"links":r.pdfItems=zoteroRoam.utils.makePDFLinks(i.filter(e=>"application/pdf"==e.data.contentType))}var l=i.filter(e=>"note"==e.data.itemType);switch(e){case"raw":r.notes=0!=l.length&&l;break;case"formatted":r.notes=0!=l.length&&zoteroRoam.handlers.formatNotes(notes=l,use=zoteroRoam.config.params.notes.use,a)}return r},getItemCollections(o){return 0<o.data.collections.length&&o.data.collections.map(t=>zoteroRoam.data.collections.find(e=>e.key==t&&e.library.id==o.library.id))},getItemRelated(o,a="citekeys"){if(!o.data.relations)return[];{let e=[];for(rel of Object.values(o.data.relations))for(match of rel.matchAll(/http:\/\/zotero.org\/(.*)\/items\/(.+)/g))e.push({lib:match[1],key:match[2]});let t=e.map(t=>zoteroRoam.data.items.find(e=>e.data.key==t.key&&`${e.library.type}s/${e.library.id}`==t.lib)||!1).filter(Boolean);switch(a){case"raw":return t;case"citekeys":return t.map(e=>"[[@"+e.key+"]]")}}},getItemType(e){let t=zoteroRoam.typemap[e.data.itemType]||e.data.itemType;return zoteroRoam.config.userSettings.typemap&&(t=zoteroRoam.config.userSettings.typemap[e.data.itemType]||t),t},getLocalLink(e,{format:t="markdown",text:o="Local library"}={}){var a=`zotero://select/${"group"==e.library.type?`groups/${e.library.id}`:"library"}/items/${e.data.key}`;switch(t){case"target":default:return a;case"markdown":return`[${o}](${a})`}},getWebLink(e,{format:t="markdown",text:o="Web library"}={}){var a=`https://www.zotero.org/${("user"==e.library.type?"users":"groups")+`/${e.library.id}`}/items/${e.data.key}`;switch(t){case"target":default:return a;case"markdown":return`[${o}](${a})`}},getTags(e){return e.data.tags.map(e=>"#[["+e.tag+"]]").join(", ")},getItemMetadata(e){let t=[];e.data.title&&t.push(`Title:: ${e.data.title}`),0<e.data.creators.length&&t.push(`Author(s):: ${zoteroRoam.formatting.getCreators(e,{creators_as:"string",brackets:!0,use_type:!0})}`),e.data.abstractNote&&t.push(`Abstract:: ${e.data.abstractNote}`),e.data.itemType&&t.push(`Type:: [[${zoteroRoam.formatting.getItemType(e)}]]`),t.push(`Publication:: ${e.data.publicationTitle||e.data.bookTitle||""}`),e.data.url&&t.push(`URL : ${e.data.url}`),e.data.dateAdded&&t.push(`Date Added:: ${zoteroRoam.utils.makeDNP(e.data.dateAdded,{brackets:!0})}`),t.push(`Zotero links:: ${zoteroRoam.formatting.getLocalLink(e,{format:format="markdown",text:text="Local library"})}, ${zoteroRoam.formatting.getWebLink(e,{format:format="markdown",text:text="Local library"})}`),0<e.data.tags.length&&t.push(`Tags:: ${zoteroRoam.formatting.getTags(e)}`);let o=zoteroRoam.formatting.getItemChildren(e,{pdf_as:"links",notes_as:"formatted"});if(o.pdfItems&&t.push(`PDF links : ${o.pdfItems.join(", ")}`),o.notes){let e={string:"[[Notes]]",children:[]};e.children.push(...o.notes.flat(1)),t.push(e)}return t}},zoteroRoam.shortcuts={actions:{closeSearchPanel:{defaultShortcut:{Escape:!0},execute(){var e=document.querySelector('.bp3-overlay[overlay-visible="true"]')||!1;e&&(Array.from(e.classList).includes(`${zoteroRoam.interface.search.overlayClass}-overlay`)?zoteroRoam.interface.toggleSearchOverlay("hide"):Array.from(e.classList).includes(`${zoteroRoam.interface.citations.overlayClass}-overlay`)?zoteroRoam.interface.closeCitationsOverlay():Array.from(e.classList).includes("zotero-roam-auxiliary-overlay")&&zoteroRoam.interface.closeAuxiliaryOverlay())}},toggleSearchPanel:{defaultShortcut:{altKey:!0,q:!0},execute(){var e;"true"==zoteroRoam.interface.citations.overlay.getAttribute("overlay-visible")?zoteroRoam.interface.closeCitationsOverlay():(e="true"==zoteroRoam.interface.search.overlay.getAttribute("overlay-visible")?"hide":"show",zoteroRoam.interface.toggleSearchOverlay(e))}},toggleQuickCopy:{defaultShortcut:[],execute(){document.getElementById("zotero-roam-quick-copy-mode").click()}},importMetadata:{defaultShortcut:[],execute(){let e=document.querySelector("button.item-add-metadata");null!==e&&e.click()}},focusSearchBar:{defaultShortcut:[],execute(){let e=document.querySelector('.bp3-overlay[overlay-visible="true"]')||!1;e&&e.querySelector('input.bp3-input[type="text"]').focus()}},goToItemPage:{defaultShortcut:[],execute(){let e=document.querySelector("a.item-go-to-page");e&&"true"==zoteroRoam.interface.search.overlay.getAttribute("overlay-visible")&&e.click()}},copyCitekey:{defaultShortcut:[],execute(){let e=document.querySelector('.item-citekey-section .copy-buttons a.bp3-button[format="citekey"]');null!==e&&e.click()}},copyCitation:{defaultShortcut:[],execute(){let e=document.querySelector('.item-citekey-section .copy-buttons a.bp3-button[format="citation"]');null!==e&&e.click()}},copyTag:{defaultShortcut:[],execute(){let e=document.querySelector('.item-citekey-section .copy-buttons a.bp3-button[format="tag"]');null!==e&&e.click()}},copyPageRef:{defaultShortcut:[],execute(){let e=document.querySelector('.item-citekey-section .copy-buttons a.bp3-button[format="page-reference"]');null!==e&&e.click()}},toggleNotes:{defaultShortcut:[],execute(){let e=document.querySelector('.zotero-roam-search-overlay[overlay-visible="true"] button.item-see-notes');null!==e&&e.click()}}},sequences:{},getSequences(t){let o=zoteroRoam.config.shortcuts.filter(e=>e.action==t);if(0==o.length)return!1;{let e=o.map(e=>{let t=[];for(key in e.template){var o;1==e.template[key]&&(o=key.endsWith("Key")?key.slice(0,-3):key,t.push(o))}return t});return e.map(e=>e.join("-")).join(" or ")}},generateSequences(){for(action in zoteroRoam.shortcuts.actions){var e=zoteroRoam.shortcuts.getSequences(action);e&&(zoteroRoam.shortcuts.sequences[action]=e)}},makeSequenceText(e,t="",o){return`${t}<span class="zotero-roam-sequence">${zoteroRoam.shortcuts.sequences[e]}</span>`},setup(){let o={};Object.keys(zoteroRoam.shortcuts.actions).forEach(e=>{o[e]=zoteroRoam.shortcuts.actions[e].defaultShortcut});let a={};zoteroRoam.config.userSettings.shortcuts?Object.keys(zoteroRoam.shortcuts.actions).forEach(e=>{var{[e]:t=o[e]}=zoteroRoam.config.userSettings.shortcuts;a[e]=t}):a=o;let t=[];for(k in a)a[k].constructor===Object?t.push({action:k,template:a[k]}):a[k].constructor===Array&&a[k].forEach(e=>{t.push({action:k,template:e})});t.forEach(e=>{zoteroRoam.config.shortcuts.push(new zoteroRoam.Shortcut(e))})},setupSequences(){zoteroRoam.shortcuts.generateSequences();let o=zoteroRoam.shortcuts.sequences.toggleSearchPanel?zoteroRoam.shortcuts.makeSequenceText("toggleSearchPanel",pre="Toggle panel with "):"",a=zoteroRoam.shortcuts.sequences.closeSearchPanel?zoteroRoam.shortcuts.makeSequenceText("closeSearchPanel",pre="Exit with "):"";if(0<o.length|0<a.length){let e=document.createElement("span");e.style="font-style:italic;font-size:0.8em;margin:10px;",e.innerHTML=`${[o,a].filter(Boolean).join(" / ")}  `;let t=zoteroRoam.interface.search.overlay.querySelector(".controls-top");if(t.insertBefore(e,zoteroRoam.interface.search.closeButton),0<a.length){let e=zoteroRoam.interface.citations.overlay.querySelector(".controls-top"),t=document.createElement("span");t.style="font-style:italic;font-size:0.8em;margin:10px;",t.innerHTML=`${a}`,e.insertBefore(t,zoteroRoam.interface.citations.closeButton);let o=document.querySelector(".zotero-roam-auxiliary-overlay .controls-top");var r=t.cloneNode(!0);o.insertBefore(r,o.querySelector(".bp3-dialog-close-button"))}}r=zoteroRoam.shortcuts.sequences.toggleQuickCopy?zoteroRoam.shortcuts.makeSequenceText("toggleQuickCopy",pre=" "):"";0<r.length&&(zoteroRoam.interface.search.overlay.querySelector(".quick-copy-element").innerHTML+=r);r=zoteroRoam.shortcuts.sequences.focusSearchBar?zoteroRoam.shortcuts.makeSequenceText("focusSearchBar"):"";if(0<r.length){let t=document.createElement("span");t.classList.add("bp3-input-action"),t.style="height:30px;padding:5px;",t.innerHTML=`${r}`,Array.from(document.querySelectorAll(`#${zoteroRoam.interface.portal.id} input.bp3-input[type="text"]`)).forEach(e=>e.closest(".bp3-input-group").appendChild(t.cloneNode(!0)))}},verify(r){let i=r.key;var n="keydown"==r.type;let s=["altKey","ctrlKey","metaKey","shiftKey"];zoteroRoam.config.shortcuts=zoteroRoam.config.shortcuts.map(e=>{let{action:t,template:o,watcher:a}=e;return s.forEach(e=>{a[e]=r[e]}),o.hasOwnProperty(i)|o.hasOwnProperty(i.toLowerCase())&&(e=o.hasOwnProperty(i)?i:i.toLowerCase(),a[e]=n),{action:t,template:o,watcher:a}}),zoteroRoam.config.shortcuts.forEach(e=>{JSON.stringify(e.watcher)===JSON.stringify(e.template)&&zoteroRoam.shortcuts.actions[`${e.action}`].execute()})}},zoteroRoam.events={ready:{},"menu-ready":{},"metadata-added":{},"notes-added":{},update:{},write:{},emit(e,t={},o=document){t=new CustomEvent(`zotero-roam:${e}`,{bubbles:!0,cancelable:!0,detail:t});1==zoteroRoam.config.userSettings.logEvents&&console.log(t),o.dispatchEvent(t)},defaultHooks(){document.addEventListener("zotero-roam:metadata-added",o=>{try{let e=document.querySelector(".item-in-graph");null!=e&&(e.innerHTML='<span class="bp3-icon-tick bp3-icon bp3-intent-success"></span><span> In the graph</span>');let t=document.querySelector(".item-go-to-page");null!=t&&(t.setAttribute("data-uid",o.detail.uid),t.setAttribute("href",`https://roamresearch.com/${window.location.hash.match(/#\/app\/([^\/]+)/g)[0]}/page/${o.detail.uid}`),t.removeAttribute("disabled"))}catch(o){}try{let e=document.querySelector(`.zotero-roam-auxiliary-overlay .bp3-menu-item[label="${o.detail.title.slice(1)}"]`);null!=e&&(e.setAttribute("in-graph","true"),e.querySelector(".zotero-roam-add-to-graph").remove())}catch(o){}try{var e=Array.from(document.querySelectorAll(`.related-item_listed[data-key="${o.detail.title}"][in-graph="false"]`));if(0<e.length)for(link of e)link.outerHTML=zoteroRoam.inPage.renderBacklinksItem(paper=o.detail.item,type=link.getAttribute("item-type"),uid=o.detail.uid)}catch(o){}}),document.addEventListener("zotero-roam:update",async function(e){e=e.detail.data?e.detail.data.items:[];if(0<e.length)for(item of e){var t=zoteroRoam.utils.parseDOI(item.data.DOI),o=Array.from(document.querySelectorAll(".zotero-roam-page-added-on"));if(0<o.length){var a,r=zoteroRoam.utils.makeDNP(item.data.dateAdded,{brackets:!1});for(btn of o)if(btn.getAttribute("data-title")==r){let e=JSON.parse(btn.getAttribute("data-keys"));e.includes(item.key)||(e.includes(item.data.key)?btn.setAttribute("data-keys",JSON.stringify(e.filter(e=>e!=item.data.key).push(item.key))):btn.setAttribute("data-keys",JSON.stringify(e.push(item.key))),a=JSON.parse(btn.getAttribute("data-keys")).length,btn.querySelector(".bp3-button-text").innerText=`${a} item${1==a?"":"s"} added`)}}o=Array.from(document.querySelectorAll(".zotero-roam-page-tagged-with"));if(0<o.length)for(btn of o){var i=btn.getAttribute("data-title");let e=JSON.parse(btn.getAttribute("data-keys"));item.data.tags&&item.data.tags.map(e=>e.tag).includes(i)&&(e.includes(item.key)||(e.includes(item.data.key)?btn.setAttribute("data-keys",JSON.stringify([...e.filter(e=>e!=item.data.key),item.key])):btn.setAttribute("data-keys",JSON.stringify([...e,item.key])),i=JSON.parse(btn.getAttribute("data-keys")).length,btn.querySelector(".bp3-button-text").innerText=`${i} tagged item${1==i?"":"s"}`))}o=Array.from(document.querySelectorAll(".zotero-roam-page-abstract-mentions"));if(0<o.length)for(btn of o){var n=btn.getAttribute("data-title");let e=JSON.parse(btn.getAttribute("data-keys"));item.data.abstractNote&&item.data.abstractNote.includes(n)&&(e.includes(item.key)||(e.includes(item.data.key)?btn.setAttribute("data-keys",JSON.stringify([...e.filter(e=>e!=item.data.key),item.key])):btn.setAttribute("data-keys",JSON.stringify([...e,item.key])),n=JSON.parse(btn.getAttribute("data-keys")).length,btn.querySelector(".bp3-button-text").innerText=`${n} abstract${1==n?"":"s"}`))}if(t&&zoteroRoam.config.params.pageMenu.defaults.includes("citingPapers"))for(menu of Array.from(document.querySelectorAll(".zotero-roam-page-menu-citations[data-doi]"))){var s=menu.dataset.doi;let e=await zoteroRoam.handlers.getSemantic(s);if(e.data){var l=e.citations.filter(e=>e.doi).map(e=>e.doi),s=e.references.filter(e=>e.doi).map(e=>e.doi);let r=[...l,...s];if(zoteroRoam.utils.includes_anycase(r,t)){let e=zoteroRoam.data.items.filter(e=>zoteroRoam.utils.parseDOI(e.data.DOI)),o=r.map(t=>e.find(e=>zoteroRoam.utils.parseDOI(e.data.DOI).toLowerCase()==t.toLowerCase())).filter(Boolean);o.forEach((e,t)=>{e=zoteroRoam.utils.parseDOI(e.data.DOI);zoteroRoam.utils.includes_anycase(l,e)?o[t].type="citing":o[t].type="cited"});let t=menu.querySelector(".zotero-roam-page-menu-backlinks-button");t.querySelector(".bp3-button-text").innerText=`${o.length} related library items`,t.classList.remove("bp3-disabled");let a=menu.querySelector(".zotero-roam-page-menu-backlinks-list");a?a.innerHTML=`${zoteroRoam.inPage.renderBacklinksList(o)}`:menu.innerHTML+=`
                                            <ul class="zotero-roam-page-menu-backlinks-list bp3-list-unstyled bp3-text-small" style="display:none;">
                                            ${zoteroRoam.inPage.renderBacklinksList(o)}
                                            </ul>
                                            `}}}}})}},(()=>{if(void 0===window.zoteroRoam_settings)throw new Error("A zoteroRoam_settings object must be defined in order to use the extension. Read through the docs for basic setup examples.");zoteroRoam.config.userSettings=window.zoteroRoam_settings,zoteroRoam.config.userSettings.theme&&(zoteroRoam.config.params.theme=zoteroRoam.config.userSettings.theme),zoteroRoam.interface.create(),zoteroRoam.interface.setup(),zoteroRoam.addExtensionCSS(),window.addEventListener("hashchange",()=>{zoteroRoam.interface.toggleSearchOverlay("hide"),zoteroRoam.interface.closeAuxiliaryOverlay()});var e=zoteroRoam.config.userSettings.override_quickcopy||!1;e&&(zoteroRoam.config.params.override_quickcopy.key=e,window.addEventListener("keydown",e=>{e.key==zoteroRoam.config.params.override_quickcopy.key|1==e[zoteroRoam.config.params.override_quickcopy.key]&&(zoteroRoam.config.params.override_quickcopy.overridden=!0)}),window.addEventListener("keyup",e=>{e.key==zoteroRoam.config.params.override_quickcopy.key|0==e[zoteroRoam.config.params.override_quickcopy.key]&&(zoteroRoam.config.params.override_quickcopy.overridden=!1)}));var t,o,a,r,{always_copy:i=!1,quick_copy_format:e="citekey"}=zoteroRoam.config.userSettings;zoteroRoam.config.params.always_copy=i,zoteroRoam.config.params.quick_copy_format=e,zoteroRoam.config.userSettings.autocomplete&&({format:e="citation",trigger:o="",display:t="citekey"}=zoteroRoam.config.userSettings.autocomplete,zoteroRoam.config.params.autocomplete.format=e,zoteroRoam.config.params.autocomplete.display=t,0<o.length&&(zoteroRoam.config.tribute.trigger=o,zoteroRoam.config.params.autocomplete.enabled=!0)),zoteroRoam.config.userSettings.notes&&({use:t="text",split_char:o="\n",func:a="zoteroRoam.utils.formatItemNotes"}=zoteroRoam.config.userSettings.notes,zoteroRoam.config.params.notes.use=t,zoteroRoam.config.params.notes.split_char=o,zoteroRoam.config.params.notes.func=a),zoteroRoam.config.userSettings.pageMenu&&({defaults:a,trigger:r}=zoteroRoam.config.userSettings.pageMenu,a&&(zoteroRoam.config.params.pageMenu.defaults=a),r&&"function"==typeof r&&(zoteroRoam.config.params.pageMenu.trigger=r)),zoteroRoam.config.userSettings.webimport&&({tags:r=[]}=zoteroRoam.config.userSettings.webimport,zoteroRoam.config.params.webimport.tags=r),zoteroRoam.shortcuts.setup(),zoteroRoam.shortcuts.setupSequences(),zoteroRoam.handlers.setupUserRequests(),zoteroRoam.events.defaultHooks(),1==zoteroRoam.config.userSettings.autoload&&setTimeout(function(){zoteroRoam.extension.load()},1e3)})();